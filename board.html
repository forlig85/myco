<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOKLUCK ê²Œì‹œíŒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root { --primary: #6366f1; --primary-light: #818cf8; --secondary: #06b6d4; --accent: #f59e0b; --success: #10b981; --danger: #ef4444; --pink: #ec4899; --bg-dark: #0a0a0f; --bg-card: #12121a; --bg-card-hover: #1a1a25; --border: #2a2a3a; --text: #f0f0f5; --text-muted: #8888a0; --gradient-primary: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%); --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); }
        body { background-color: var(--bg-dark); background-image: radial-gradient(ellipse at top, rgba(99,102,241,0.1) 0%, transparent 50%); color: var(--text); font-family: 'Noto Sans KR', sans-serif; min-height: 100vh; }
        
        .navbar { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 12px 20px; position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 900px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 900; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; text-decoration: none; }
        .nav-links { display: flex; gap: 8px; }
        .nav-link { padding: 8px 16px; border-radius: 8px; color: var(--text-muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .nav-link:hover, .nav-link.active { background: var(--bg-card-hover); color: var(--text); }
        
        .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; padding: 8px; }
        .hamburger span { width: 24px; height: 2px; background: var(--text); transition: all 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        
        .mobile-menu { display: none; position: fixed; top: 60px; left: 0; right: 0; bottom: 0; background: var(--bg-dark); z-index: 99; padding: 20px; flex-direction: column; gap: 8px; }
        .mobile-menu.active { display: flex; }
        .mobile-menu .nav-link { padding: 16px; font-size: 16px; border-radius: 12px; background: var(--bg-card); }
        
        .nav-right { display: flex; align-items: center; gap: 12px; }
        .wallet-badge { background: var(--bg-dark); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--border); color: var(--secondary); font-weight: 700; font-size: 14px; }
        
        .notification-bell { position: relative; cursor: pointer; padding: 8px; font-size: 18px; }
        .notification-bell .badge { position: absolute; top: 2px; right: 2px; background: var(--danger); color: white; font-size: 10px; font-weight: 700; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 24px 20px; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-size: 14px; margin-bottom: 20px; }
        .back-btn:hover { color: var(--text); }
        
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        
        button { cursor: pointer; border: none; border-radius: 10px; font-weight: 600; padding: 12px 20px; transition: all 0.2s; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; }
        button:hover { transform: translateY(-1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-gold { background: var(--gradient-gold); color: #1a1a2e; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 8px 14px; font-size: 13px; }
        .btn-block { width: 100%; }
        
        input, textarea, select { width: 100%; background: var(--bg-dark); border: 1px solid var(--border); color: var(--text); padding: 14px 16px; border-radius: 10px; font-size: 15px; font-family: 'Noto Sans KR', sans-serif; margin-bottom: 12px; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--primary); }
        label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }

        /* ê²Œì‹œíŒ í—¤ë” */
        .board-header { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
        .board-icon { width: 64px; height: 64px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 32px; }
        .board-info h1 { font-size: 24px; margin-bottom: 4px; }
        .board-meta { color: var(--text-muted); font-size: 14px; }
        .board-actions { margin-left: auto; display: flex; gap: 8px; }
        .subscribe-btn { display: flex; align-items: center; gap: 6px; }
        .subscribe-btn.subscribed { background: var(--success); color: white; }

        /* íƒ­ */
        .tabs { display: flex; gap: 4px; background: var(--bg-dark); padding: 4px; border-radius: 12px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; text-align: center; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s; color: var(--text-muted); }
        .tab.active { background: var(--bg-card); color: var(--text); }

        /* ê²Œì‹œê¸€ ì‘ì„± */
        .write-box { margin-bottom: 24px; }
        .write-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .hashtag-input { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .hashtag { background: rgba(99,102,241,0.2); color: var(--primary-light); padding: 4px 12px; border-radius: 20px; font-size: 13px; display: flex; align-items: center; gap: 6px; }
        .hashtag .remove { cursor: pointer; opacity: 0.7; }
        .hashtag .remove:hover { opacity: 1; }
        .image-preview { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 12px; }
        .image-preview-item { position: relative; width: 100px; height: 100px; border-radius: 10px; overflow: hidden; }
        .image-preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .image-preview-item .remove-img { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.7); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; }
        
        /* íˆ¬í‘œ ìƒì„± */
        .poll-creator { background: var(--bg-dark); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .poll-option-input { display: flex; gap: 8px; margin-bottom: 8px; }
        .poll-option-input input { flex: 1; margin: 0; }

        /* ê²Œì‹œê¸€ ëª©ë¡ */
        .post-item { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .post-item:hover { border-color: var(--primary); transform: translateX(4px); }
        .post-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .post-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .post-author { font-weight: 600; font-size: 14px; }
        .post-time { font-size: 12px; color: var(--text-muted); }
        .post-title { font-size: 17px; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .post-title .hot-badge { background: var(--danger); color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px; }
        .post-content { color: var(--text-muted); font-size: 14px; line-height: 1.6; margin-bottom: 12px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .post-images { display: flex; gap: 8px; margin-bottom: 12px; }
        .post-images img { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; }
        .post-hashtags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .post-hashtag { background: rgba(99,102,241,0.15); color: var(--primary-light); padding: 3px 10px; border-radius: 15px; font-size: 12px; }
        .post-footer { display: flex; align-items: center; gap: 16px; }
        .post-stat { display: flex; align-items: center; gap: 4px; font-size: 13px; color: var(--text-muted); cursor: pointer; padding: 4px 8px; border-radius: 6px; transition: all 0.2s; }
        .post-stat:hover { background: var(--bg-card-hover); }
        .post-stat.liked { color: var(--danger); }
        .post-stat.bookmarked { color: var(--accent); }

        /* íˆ¬í‘œ */
        .poll-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .poll-title { font-weight: 700; margin-bottom: 12px; }
        .poll-option { background: var(--bg-dark); border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; position: relative; overflow: hidden; transition: all 0.2s; }
        .poll-option:hover { border-color: var(--primary); }
        .poll-option.voted { border: 2px solid var(--primary); }
        .poll-option-bar { position: absolute; top: 0; left: 0; height: 100%; background: rgba(99,102,241,0.2); transition: width 0.5s; }
        .poll-option-text { position: relative; z-index: 1; display: flex; justify-content: space-between; }
        .poll-total { font-size: 12px; color: var(--text-muted); margin-top: 8px; }

        /* ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: flex-start; z-index: 1000; backdrop-filter: blur(8px); overflow-y: auto; padding: 40px 20px; }
        .modal-content { background: var(--bg-card); border-radius: 20px; width: 100%; max-width: 700px; border: 1px solid var(--border); position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: var(--bg-dark); border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px; color: var(--text-muted); z-index: 10; }

        .post-detail-header { padding: 24px 24px 0; }
        .post-detail-title { font-size: 22px; font-weight: 900; margin-bottom: 16px; line-height: 1.4; }
        .post-detail-meta { display: flex; align-items: center; gap: 12px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
        .post-detail-content { padding: 24px; line-height: 1.8; font-size: 15px; white-space: pre-wrap; }
        .post-detail-images { padding: 0 24px 24px; display: flex; flex-wrap: wrap; gap: 12px; }
        .post-detail-images img { max-width: 100%; border-radius: 12px; cursor: pointer; }
        .post-detail-actions { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 12px; flex-wrap: wrap; }
        .action-btn { display: flex; align-items: center; gap: 6px; padding: 10px 16px; background: var(--bg-dark); border-radius: 10px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .action-btn:hover { background: var(--bg-card-hover); }
        .action-btn.active { color: var(--primary-light); }
        .action-btn.liked { color: var(--danger); }

        /* ëŒ“ê¸€ */
        .comments-section { padding: 24px; border-top: 1px solid var(--border); }
        .comments-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .comment-write { display: flex; gap: 12px; margin-bottom: 20px; }
        .comment-write textarea { flex: 1; margin: 0; min-height: 60px; resize: none; }
        .comment-item { background: var(--bg-dark); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .comment-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .comment-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .comment-author { font-weight: 600; font-size: 13px; }
        .comment-time { font-size: 11px; color: var(--text-muted); }
        .comment-content { font-size: 14px; line-height: 1.5; margin-bottom: 8px; }
        .comment-content .mention { color: var(--primary-light); cursor: pointer; }
        .comment-actions { display: flex; gap: 12px; }
        .comment-action { font-size: 12px; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .comment-action:hover { color: var(--text); }
        .comment-action.liked { color: var(--danger); }
        .reply-write { margin-top: 12px; padding-left: 20px; border-left: 2px solid var(--border); }
        .replies { margin-top: 12px; padding-left: 20px; border-left: 2px solid var(--border); }
        .reply-item { background: var(--bg-card-hover); border-radius: 10px; padding: 12px; margin-bottom: 8px; }

        /* ì‹ ê³  ëª¨ë‹¬ */
        .report-options { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
        .report-option { padding: 12px 16px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .report-option:hover { border-color: var(--primary); }
        .report-option.selected { border-color: var(--danger); background: rgba(239,68,68,0.1); }

        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hamburger { display: flex; }
            .board-header { flex-direction: column; text-align: center; }
            .board-actions { margin: 16px 0 0 0; }
            .post-detail-actions { justify-content: center; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">BOKLUCK</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">ğŸ  í™ˆ</a>
                <a href="index.html" class="nav-link active">ğŸ“‚ ê²Œì‹œíŒ</a>
                <a href="market.html" class="nav-link">ğŸ—ºï¸ ë¶€ë™ì‚°</a>
                <a href="board-market.html" class="nav-link">ğŸª ë§ˆì¼“</a>
            </div>
            <div class="nav-right">
                <div class="notification-bell">ğŸ””<span class="badge hidden" id="notifBadge">0</span></div>
                <div class="wallet-badge" id="walletBadge">ğŸ’° ì—°ê²° í•„ìš”</div>
                <div class="hamburger" id="hamburger" onclick="toggleMobileMenu()">
                    <span></span><span></span><span></span>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="nav-link">ğŸ  í™ˆ</a>
        <a href="index.html" class="nav-link">ğŸ“‚ ê²Œì‹œíŒ</a>
        <a href="market.html" class="nav-link">ğŸ—ºï¸ ë¶€ë™ì‚°</a>
        <a href="board-market.html" class="nav-link">ğŸª ë§ˆì¼“</a>
    </div>

    <div class="container">
        <a href="index.html" class="back-btn">â† ê²Œì‹œíŒ ëª©ë¡</a>

        <!-- ê²Œì‹œíŒ í—¤ë” -->
        <div class="card">
            <div class="board-header">
                <div class="board-icon" id="boardIcon" style="background: #6366f1;">ğŸ“</div>
                <div class="board-info">
                    <h1 id="boardName">ê²Œì‹œíŒ ì´ë¦„</h1>
                    <div class="board-meta">
                        <span id="boardDesc">ì„¤ëª…</span> Â· 
                        <span id="boardOwner">ìš´ì˜ì</span> Â· 
                        <span>ğŸ‘¤ <span id="memberCount">0</span></span> Â· 
                        <span>ğŸ“ <span id="postCount">0</span></span>
                    </div>
                </div>
                <div class="board-actions">
                    <button class="btn-outline btn-sm subscribe-btn" id="subscribeBtn" onclick="toggleSubscribe()">
                        <span>â­</span> êµ¬ë…
                    </button>
                    <button class="btn-outline btn-sm" onclick="openModal('boardInfoModal')">â„¹ï¸</button>
                </div>
            </div>
        </div>

        <!-- ê¸€ì“°ê¸° -->
        <div class="card write-box" id="writeBox">
            <div class="write-header">
                <h3>âœï¸ ìƒˆ ê¸€ ì‘ì„±</h3>
                <span id="writeCost" style="color: var(--accent); font-weight: 600;">ì‘ì„±ë¹„: 0 BOK</span>
            </div>
            <input type="text" id="postTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <textarea id="postContent" rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”... (@ìœ¼ë¡œ ë©˜ì…˜, #ìœ¼ë¡œ í•´ì‹œíƒœê·¸)"></textarea>
            
            <!-- í•´ì‹œíƒœê·¸ -->
            <div class="hashtag-input" id="hashtagContainer"></div>
            <input type="text" id="hashtagInput" placeholder="í•´ì‹œíƒœê·¸ ì…ë ¥ í›„ Enter (#ì—†ì´ ì…ë ¥)" onkeypress="addHashtag(event)">
            
            <!-- ì´ë¯¸ì§€ ì²¨ë¶€ -->
            <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px;">
                <label for="imageInput" style="cursor: pointer; padding: 10px 16px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 10px; font-size: 14px;">
                    ğŸ“· ì´ë¯¸ì§€ ì²¨ë¶€
                </label>
                <input type="file" id="imageInput" accept="image/*" multiple style="display: none;" onchange="previewImages(event)">
                <button class="btn-outline btn-sm" onclick="togglePollCreator()">ğŸ“Š íˆ¬í‘œ ì¶”ê°€</button>
            </div>
            <div class="image-preview" id="imagePreview"></div>
            
            <!-- íˆ¬í‘œ ìƒì„± -->
            <div class="poll-creator hidden" id="pollCreator">
                <h4 style="margin-bottom: 12px;">ğŸ“Š íˆ¬í‘œ ë§Œë“¤ê¸°</h4>
                <input type="text" id="pollQuestion" placeholder="íˆ¬í‘œ ì§ˆë¬¸">
                <div id="pollOptions">
                    <div class="poll-option-input">
                        <input type="text" placeholder="ì„ íƒì§€ 1" class="poll-opt">
                        <button class="btn-outline btn-sm" onclick="this.parentElement.remove()">âœ•</button>
                    </div>
                    <div class="poll-option-input">
                        <input type="text" placeholder="ì„ íƒì§€ 2" class="poll-opt">
                        <button class="btn-outline btn-sm" onclick="this.parentElement.remove()">âœ•</button>
                    </div>
                </div>
                <button class="btn-outline btn-sm" onclick="addPollOption()" style="margin-top: 8px;">+ ì„ íƒì§€ ì¶”ê°€</button>
            </div>
            
            <button class="btn-primary btn-block" onclick="writePost()" style="margin-top: 16px;">ê¸€ ì‘ì„±í•˜ê¸° (+100 BOK)</button>
        </div>

        <!-- íƒ­ -->
        <div class="tabs">
            <div class="tab active" onclick="filterPosts('latest')">ìµœì‹ ìˆœ</div>
            <div class="tab" onclick="filterPosts('popular')">ì¸ê¸°ìˆœ</div>
            <div class="tab" onclick="filterPosts('bookmarked')">ë¶ë§ˆí¬</div>
        </div>

        <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
        <div id="postList">
            <div style="text-align: center; color: var(--text-muted); padding: 60px;">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“</div>
                <p>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <!-- ê¸€ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="postDetailModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('postDetailModal')">âœ•</button>
            
            <div class="post-detail-header">
                <div class="post-detail-title" id="detailTitle">ì œëª©</div>
                <div class="post-detail-meta">
                    <div class="post-avatar">ğŸ‘¤</div>
                    <div>
                        <div class="post-author" id="detailAuthor">ì‘ì„±ì</div>
                        <div class="post-time" id="detailTime">ì‹œê°„</div>
                    </div>
                </div>
            </div>
            
            <div class="post-detail-content" id="detailContent">ë‚´ìš©</div>
            <div class="post-detail-images" id="detailImages"></div>
            
            <!-- íˆ¬í‘œ -->
            <div class="poll-container hidden" id="detailPoll">
                <div class="poll-title" id="pollQuestion"></div>
                <div id="pollOptionsList"></div>
                <div class="poll-total" id="pollTotal">ì´ 0í‘œ</div>
            </div>
            
            <div class="post-detail-actions">
                <div class="action-btn" id="likeBtn" onclick="toggleLike()">
                    <span>â¤ï¸</span> <span id="likeCount">0</span>
                </div>
                <div class="action-btn" id="bookmarkBtn" onclick="toggleBookmark()">
                    <span>ğŸ”–</span> ë¶ë§ˆí¬
                </div>
                <div class="action-btn" onclick="sharePost()">
                    <span>ğŸ”—</span> ê³µìœ 
                </div>
                <div class="action-btn" onclick="openReportModal()" style="margin-left: auto; color: var(--danger);">
                    <span>ğŸš¨</span> ì‹ ê³ 
                </div>
            </div>
            
            <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
            <div class="comments-section">
                <div class="comments-header">
                    <h4>ğŸ’¬ ëŒ“ê¸€ <span id="commentCount">0</span></h4>
                </div>
                <div class="comment-write">
                    <textarea id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... (@ìœ¼ë¡œ ë©˜ì…˜ ê°€ëŠ¥)"></textarea>
                    <button class="btn-primary" onclick="writeComment()">ì‘ì„±</button>
                </div>
                <div id="commentList"></div>
            </div>
        </div>
    </div>

    <!-- ì‹ ê³  ëª¨ë‹¬ -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal-content" style="max-width: 400px; padding: 24px;">
            <button class="modal-close" onclick="closeModal('reportModal')">âœ•</button>
            <h3 style="margin-bottom: 20px; text-align: center;">ğŸš¨ ì‹ ê³ í•˜ê¸°</h3>
            <div class="report-options">
                <div class="report-option" onclick="selectReportReason(this, 'spam')">ğŸš« ìŠ¤íŒ¸/ê´‘ê³ </div>
                <div class="report-option" onclick="selectReportReason(this, 'abuse')">ğŸ˜  ìš•ì„¤/ë¹„ë°©</div>
                <div class="report-option" onclick="selectReportReason(this, 'adult')">ğŸ” ì„±ì¸ ì½˜í…ì¸ </div>
                <div class="report-option" onclick="selectReportReason(this, 'scam')">ğŸ’¸ ì‚¬ê¸°/í—ˆìœ„ì •ë³´</div>
                <div class="report-option" onclick="selectReportReason(this, 'other')">ğŸ“ ê¸°íƒ€</div>
            </div>
            <textarea id="reportDetail" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)" rows="3"></textarea>
            <button class="btn-danger btn-block" onclick="submitReport()">ì‹ ê³  ì œì¶œ</button>
        </div>
    </div>

    <!-- ê²Œì‹œíŒ ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="boardInfoModal">
        <div class="modal-content" style="max-width: 400px; padding: 24px;">
            <button class="modal-close" onclick="closeModal('boardInfoModal')">âœ•</button>
            <h3 style="margin-bottom: 20px; text-align: center;">â„¹ï¸ ê²Œì‹œíŒ ì •ë³´</h3>
            <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                <p><strong>ìš´ì˜ì:</strong> <span id="infoOwner">-</span></p>
                <p style="margin-top: 8px;"><strong>ìƒì„±ì¼:</strong> <span id="infoCreated">-</span></p>
                <p style="margin-top: 8px;"><strong>ì…ì¥ë£Œ:</strong> <span id="infoEntry">ë¬´ë£Œ</span></p>
                <p style="margin-top: 8px;"><strong>ê¸€ì“°ê¸° ë¹„ìš©:</strong> <span id="infoWrite">0 BOK</span></p>
            </div>
            <button class="btn-outline btn-block" onclick="closeModal('boardInfoModal')">ë‹«ê¸°</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, query, orderBy, where, increment, runTransaction, addDoc, deleteDoc, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

        const firebaseConfig = { apiKey: "AIzaSyBwQjuqgWM4YKnqu_gzNbeCg5alrC-jVcQ", authDomain: "myco-737a0.firebaseapp.com", projectId: "myco-737a0", storageBucket: "myco-737a0.firebasestorage.app", messagingSenderId: "942571332540", appId: "1:942571332540:web:be0bb6fbdd32655501c1b9" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        let currentUser = null, userData = null, boardData = null;
        let currentPostId = null, selectedReportReason = null;
        let hashtags = [], uploadedImages = [];
        
        const urlParams = new URLSearchParams(window.location.search);
        const boardId = urlParams.get('id');

        window.toggleMobileMenu = function() {
            document.getElementById("hamburger").classList.toggle("active");
            document.getElementById("mobileMenu").classList.toggle("active");
        };

        // ê²Œì‹œíŒ ë¡œë“œ
        async function loadBoard() {
            if(!boardId) { alert("ê²Œì‹œíŒ IDê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
            
            onSnapshot(doc(db, "boards", boardId), (docSnap) => {
                if(!docSnap.exists()) { alert("ê²Œì‹œíŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
                boardData = docSnap.data();
                
                document.getElementById("boardName").textContent = boardData.name;
                document.getElementById("boardDesc").textContent = boardData.description || "ì„¤ëª… ì—†ìŒ";
                document.getElementById("boardOwner").textContent = boardData.ownerName;
                document.getElementById("boardIcon").style.background = boardData.color || "#6366f1";
                document.getElementById("boardIcon").textContent = boardData.icon || "ğŸ“";
                document.getElementById("memberCount").textContent = boardData.memberCount || 0;
                document.getElementById("postCount").textContent = boardData.postCount || 0;
                document.getElementById("writeCost").textContent = `ì‘ì„±ë¹„: ${boardData.writeFee || 0} BOK`;
                
                document.getElementById("infoOwner").textContent = boardData.ownerName;
                document.getElementById("infoCreated").textContent = boardData.createdAt ? new Date(boardData.createdAt).toLocaleDateString() : '-';
                document.getElementById("infoEntry").textContent = boardData.entryFee > 0 ? `${boardData.entryFee} BOK` : 'ë¬´ë£Œ';
                document.getElementById("infoWrite").textContent = `${boardData.writeFee || 0} BOK`;
                
                document.title = `${boardData.name} - BOKLUCK`;
                
                // ë¯¸ì…˜: ê²Œì‹œíŒ ë°©ë¬¸
                if(currentUser) updateMission('visits');
            });
            
            loadPosts();
        }

        // ê²Œì‹œê¸€ ë¡œë“œ
        function loadPosts() {
            const q = query(collection(db, "posts"), where("boardId", "==", boardId), orderBy("createdAt", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById("postList");
                
                if(snapshot.empty) {
                    list.innerHTML = `<div style="text-align: center; color: var(--text-muted); padding: 60px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“</div>
                        <p>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>`;
                    return;
                }
                
                list.innerHTML = "";
                snapshot.forEach(docSnap => {
                    const p = docSnap.data();
                    const isHot = (p.likeCount || 0) >= 5;
                    const isLiked = currentUser && p.likedBy?.includes(currentUser.uid);
                    const isBookmarked = currentUser && p.bookmarkedBy?.includes(currentUser.uid);
                    
                    let hashtagsHtml = '';
                    if(p.hashtags?.length) {
                        hashtagsHtml = `<div class="post-hashtags">${p.hashtags.map(t => `<span class="post-hashtag">#${t}</span>`).join('')}</div>`;
                    }
                    
                    let imagesHtml = '';
                    if(p.images?.length) {
                        imagesHtml = `<div class="post-images">${p.images.slice(0,3).map(url => `<img src="${url}" alt="ì´ë¯¸ì§€">`).join('')}</div>`;
                    }
                    
                    list.innerHTML += `
                        <div class="post-item" onclick="openPostDetail('${docSnap.id}')">
                            <div class="post-header">
                                <div class="post-avatar">${p.authorCountry || 'ğŸ‘¤'}</div>
                                <div>
                                    <div class="post-author">${p.authorName}</div>
                                    <div class="post-time">${timeAgo(p.createdAt)}</div>
                                </div>
                            </div>
                            <div class="post-title">
                                ${isHot ? '<span class="hot-badge">ğŸ”¥ HOT</span>' : ''}
                                ${p.title}
                            </div>
                            <div class="post-content">${p.content}</div>
                            ${imagesHtml}
                            ${hashtagsHtml}
                            <div class="post-footer">
                                <div class="post-stat ${isLiked ? 'liked' : ''}">â¤ï¸ ${p.likeCount || 0}</div>
                                <div class="post-stat">ğŸ’¬ ${p.commentCount || 0}</div>
                                <div class="post-stat">ğŸ‘ï¸ ${p.viewCount || 0}</div>
                                <div class="post-stat ${isBookmarked ? 'bookmarked' : ''}">ğŸ”–</div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // ê¸€ ìƒì„¸ ë³´ê¸°
        window.openPostDetail = async function(postId) {
            currentPostId = postId;
            const postRef = doc(db, "posts", postId);
            
            // ì¡°íšŒìˆ˜ ì¦ê°€
            await updateDoc(postRef, { viewCount: increment(1) });
            
            onSnapshot(postRef, (docSnap) => {
                if(!docSnap.exists()) return;
                const p = docSnap.data();
                
                document.getElementById("detailTitle").textContent = p.title;
                document.getElementById("detailAuthor").textContent = `${p.authorCountry || ''} ${p.authorName}`;
                document.getElementById("detailTime").textContent = timeAgo(p.createdAt);
                
                // ë©˜ì…˜ ì²˜ë¦¬
                let content = p.content;
                content = content.replace(/@(\w+)/g, '<span class="mention">@$1</span>');
                document.getElementById("detailContent").innerHTML = content;
                
                // ì´ë¯¸ì§€
                const imgContainer = document.getElementById("detailImages");
                imgContainer.innerHTML = "";
                if(p.images?.length) {
                    p.images.forEach(url => {
                        imgContainer.innerHTML += `<img src="${url}" alt="ì´ë¯¸ì§€" onclick="window.open('${url}')">`;
                    });
                }
                
                // ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ìƒíƒœ
                const isLiked = currentUser && p.likedBy?.includes(currentUser.uid);
                const isBookmarked = currentUser && p.bookmarkedBy?.includes(currentUser.uid);
                document.getElementById("likeBtn").className = `action-btn ${isLiked ? 'liked' : ''}`;
                document.getElementById("likeCount").textContent = p.likeCount || 0;
                document.getElementById("bookmarkBtn").className = `action-btn ${isBookmarked ? 'active' : ''}`;
                
                // íˆ¬í‘œ
                const pollSection = document.getElementById("detailPoll");
                if(p.poll) {
                    pollSection.classList.remove("hidden");
                    document.getElementById("pollQuestion").textContent = p.poll.question;
                    const totalVotes = Object.values(p.poll.votes || {}).reduce((a,b) => a+b, 0);
                    document.getElementById("pollTotal").textContent = `ì´ ${totalVotes}í‘œ`;
                    
                    const votedOption = currentUser ? p.poll.votedBy?.[currentUser.uid] : null;
                    const optList = document.getElementById("pollOptionsList");
                    optList.innerHTML = "";
                    
                    p.poll.options.forEach((opt, i) => {
                        const votes = p.poll.votes?.[i] || 0;
                        const percent = totalVotes > 0 ? Math.round((votes/totalVotes)*100) : 0;
                        const isVoted = votedOption === i;
                        
                        optList.innerHTML += `
                            <div class="poll-option ${isVoted ? 'voted' : ''}" onclick="votePoll(${i})">
                                <div class="poll-option-bar" style="width: ${percent}%;"></div>
                                <div class="poll-option-text">
                                    <span>${opt}</span>
                                    <span>${percent}% (${votes})</span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    pollSection.classList.add("hidden");
                }
                
                document.getElementById("commentCount").textContent = p.commentCount || 0;
            });
            
            loadComments(postId);
            openModal('postDetailModal');
        };

        // ëŒ“ê¸€ ë¡œë“œ
        function loadComments(postId) {
            const q = query(collection(db, "comments"), where("postId", "==", postId), orderBy("createdAt", "asc"));
            
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById("commentList");
                list.innerHTML = "";
                
                snapshot.forEach(docSnap => {
                    const c = docSnap.data();
                    const isLiked = currentUser && c.likedBy?.includes(currentUser.uid);
                    
                    // ë©˜ì…˜ ì²˜ë¦¬
                    let content = c.content;
                    content = content.replace(/@(\w+)/g, '<span class="mention">@$1</span>');
                    
                    list.innerHTML += `
                        <div class="comment-item">
                            <div class="comment-header">
                                <div class="comment-avatar">${c.authorCountry || 'ğŸ‘¤'}</div>
                                <div>
                                    <span class="comment-author">${c.authorName}</span>
                                    <span class="comment-time">${timeAgo(c.createdAt)}</span>
                                </div>
                            </div>
                            <div class="comment-content">${content}</div>
                            <div class="comment-actions">
                                <span class="comment-action ${isLiked ? 'liked' : ''}" onclick="likeComment('${docSnap.id}')">â¤ï¸ ${c.likeCount || 0}</span>
                                <span class="comment-action" onclick="replyTo('${c.authorName}')">â†©ï¸ ë‹µê¸€</span>
                                <span class="comment-action" onclick="reportComment('${docSnap.id}')" style="color: var(--danger);">ğŸš¨</span>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // ì¢‹ì•„ìš”
        window.toggleLike = async function() {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if(!currentPostId) return;
            
            const postRef = doc(db, "posts", currentPostId);
            const postSnap = await getDoc(postRef);
            const post = postSnap.data();
            
            const likedBy = post.likedBy || [];
            const isLiked = likedBy.includes(currentUser.uid);
            
            if(isLiked) {
                await updateDoc(postRef, {
                    likedBy: likedBy.filter(id => id !== currentUser.uid),
                    likeCount: increment(-1)
                });
            } else {
                await updateDoc(postRef, {
                    likedBy: [...likedBy, currentUser.uid],
                    likeCount: increment(1)
                });
                
                // ë¯¸ì…˜
                updateMission('likes');
                
                // ì•Œë¦¼
                if(post.authorUid !== currentUser.uid) {
                    await addDoc(collection(db, "notifications"), {
                        userId: post.authorUid,
                        type: 'like',
                        title: 'ì¢‹ì•„ìš”',
                        message: `${userData?.name || 'ëˆ„êµ°ê°€'}ë‹˜ì´ "${post.title}" ê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤!`,
                        read: false,
                        createdAt: new Date().toISOString()
                    });
                }
            }
        };

        // ë¶ë§ˆí¬
        window.toggleBookmark = async function() {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if(!currentPostId) return;
            
            const postRef = doc(db, "posts", currentPostId);
            const postSnap = await getDoc(postRef);
            const post = postSnap.data();
            
            const bookmarkedBy = post.bookmarkedBy || [];
            const isBookmarked = bookmarkedBy.includes(currentUser.uid);
            
            if(isBookmarked) {
                await updateDoc(postRef, { bookmarkedBy: bookmarkedBy.filter(id => id !== currentUser.uid) });
                alert("ë¶ë§ˆí¬ í•´ì œë¨");
            } else {
                await updateDoc(postRef, { bookmarkedBy: [...bookmarkedBy, currentUser.uid] });
                alert("ë¶ë§ˆí¬ ì¶”ê°€ë¨");
            }
        };

        // íˆ¬í‘œ
        window.votePoll = async function(optionIndex) {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if(!currentPostId) return;
            
            const postRef = doc(db, "posts", currentPostId);
            const postSnap = await getDoc(postRef);
            const post = postSnap.data();
            
            if(post.poll.votedBy?.[currentUser.uid] !== undefined) {
                return alert("ì´ë¯¸ íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤.");
            }
            
            const votes = post.poll.votes || {};
            votes[optionIndex] = (votes[optionIndex] || 0) + 1;
            
            const votedBy = post.poll.votedBy || {};
            votedBy[currentUser.uid] = optionIndex;
            
            await updateDoc(postRef, {
                'poll.votes': votes,
                'poll.votedBy': votedBy
            });
        };

        // ëŒ“ê¸€ ì‘ì„±
        window.writeComment = async function() {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            const content = document.getElementById("commentInput").value.trim();
            if(!content) return alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.");
            
            try {
                await addDoc(collection(db, "comments"), {
                    postId: currentPostId,
                    boardId: boardId,
                    authorUid: currentUser.uid,
                    authorName: currentUser.displayName,
                    authorCountry: userData?.country || '',
                    content,
                    likeCount: 0,
                    likedBy: [],
                    createdAt: new Date().toISOString()
                });
                
                await updateDoc(doc(db, "posts", currentPostId), { commentCount: increment(1) });
                await updateDoc(doc(db, "users", currentUser.uid), { commentCount: increment(1) });
                
                // ë¯¸ì…˜
                updateMission('comments');
                
                // ë©˜ì…˜ ì•Œë¦¼
                const mentions = content.match(/@(\w+)/g);
                if(mentions) {
                    for(const mention of mentions) {
                        const name = mention.slice(1);
                        const userQuery = query(collection(db, "users"), where("name", "==", name), limit(1));
                        const userSnap = await getDocs(userQuery);
                        if(!userSnap.empty) {
                            const targetUser = userSnap.docs[0];
                            if(targetUser.id !== currentUser.uid) {
                                await addDoc(collection(db, "notifications"), {
                                    userId: targetUser.id,
                                    type: 'comment',
                                    title: 'ë©˜ì…˜',
                                    message: `${currentUser.displayName}ë‹˜ì´ ëŒ“ê¸€ì—ì„œ ë‹¹ì‹ ì„ ë©˜ì…˜í–ˆìŠµë‹ˆë‹¤!`,
                                    read: false,
                                    createdAt: new Date().toISOString()
                                });
                            }
                        }
                    }
                }
                
                // ê¸€ ì‘ì„±ìì—ê²Œ ì•Œë¦¼
                const postSnap = await getDoc(doc(db, "posts", currentPostId));
                if(postSnap.exists() && postSnap.data().authorUid !== currentUser.uid) {
                    await addDoc(collection(db, "notifications"), {
                        userId: postSnap.data().authorUid,
                        type: 'comment',
                        title: 'ìƒˆ ëŒ“ê¸€',
                        message: `${currentUser.displayName}ë‹˜ì´ "${postSnap.data().title}"ì— ëŒ“ê¸€ì„ ë‹¬ì•˜ìŠµë‹ˆë‹¤.`,
                        read: false,
                        createdAt: new Date().toISOString()
                    });
                }
                
                document.getElementById("commentInput").value = "";
            } catch(e) { alert("ì˜¤ë¥˜: " + e); }
        };

        // ëŒ“ê¸€ ì¢‹ì•„ìš”
        window.likeComment = async function(commentId) {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            
            const commentRef = doc(db, "comments", commentId);
            const commentSnap = await getDoc(commentRef);
            const comment = commentSnap.data();
            
            const likedBy = comment.likedBy || [];
            const isLiked = likedBy.includes(currentUser.uid);
            
            if(isLiked) {
                await updateDoc(commentRef, {
                    likedBy: likedBy.filter(id => id !== currentUser.uid),
                    likeCount: increment(-1)
                });
            } else {
                await updateDoc(commentRef, {
                    likedBy: [...likedBy, currentUser.uid],
                    likeCount: increment(1)
                });
            }
        };

        // ë‹µê¸€
        window.replyTo = function(authorName) {
            document.getElementById("commentInput").value = `@${authorName} `;
            document.getElementById("commentInput").focus();
        };

        // í•´ì‹œíƒœê·¸
        window.addHashtag = function(e) {
            if(e.key !== 'Enter') return;
            e.preventDefault();
            const input = document.getElementById("hashtagInput");
            const tag = input.value.trim().replace(/^#/, '');
            if(!tag || hashtags.includes(tag)) return;
            if(hashtags.length >= 5) return alert("ìµœëŒ€ 5ê°œê¹Œì§€");
            
            hashtags.push(tag);
            renderHashtags();
            input.value = "";
        };

        function renderHashtags() {
            const container = document.getElementById("hashtagContainer");
            container.innerHTML = hashtags.map((t, i) => `
                <span class="hashtag">#${t} <span class="remove" onclick="removeHashtag(${i})">âœ•</span></span>
            `).join('');
        }

        window.removeHashtag = function(index) {
            hashtags.splice(index, 1);
            renderHashtags();
        };

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        window.previewImages = function(e) {
            const files = e.target.files;
            const container = document.getElementById("imagePreview");
            
            for(const file of files) {
                if(uploadedImages.length >= 5) { alert("ìµœëŒ€ 5ê°œê¹Œì§€"); break; }
                
                const reader = new FileReader();
                reader.onload = function(ev) {
                    const idx = uploadedImages.length;
                    uploadedImages.push(file);
                    container.innerHTML += `
                        <div class="image-preview-item" id="img-${idx}">
                            <img src="${ev.target.result}">
                            <div class="remove-img" onclick="removeImage(${idx})">âœ•</div>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        };

        window.removeImage = function(index) {
            uploadedImages[index] = null;
            document.getElementById(`img-${index}`)?.remove();
        };

        // íˆ¬í‘œ ìƒì„±ê¸° í† ê¸€
        window.togglePollCreator = function() {
            document.getElementById("pollCreator").classList.toggle("hidden");
        };

        window.addPollOption = function() {
            const container = document.getElementById("pollOptions");
            const count = container.children.length + 1;
            container.innerHTML += `
                <div class="poll-option-input">
                    <input type="text" placeholder="ì„ íƒì§€ ${count}" class="poll-opt">
                    <button class="btn-outline btn-sm" onclick="this.parentElement.remove()">âœ•</button>
                </div>
            `;
        };

        // ê¸€ ì‘ì„±
        window.writePost = async function() {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            const title = document.getElementById("postTitle").value.trim();
            const content = document.getElementById("postContent").value.trim();
            if(!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
            
            const writeFee = boardData?.writeFee || 0;
            if(userData.coin < writeFee) return alert(`BOKì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${writeFee})`);
            
            const btn = document.querySelector('.write-box button');
            btn.disabled = true;
            btn.textContent = "ì‘ì„± ì¤‘...";
            
            try {
                // ì´ë¯¸ì§€ ì—…ë¡œë“œ
                let imageUrls = [];
                for(const file of uploadedImages) {
                    if(!file) continue;
                    const storageRef = ref(storage, `posts/${Date.now()}_${file.name}`);
                    await uploadBytes(storageRef, file);
                    const url = await getDownloadURL(storageRef);
                    imageUrls.push(url);
                }
                
                // íˆ¬í‘œ ë°ì´í„°
                let pollData = null;
                if(!document.getElementById("pollCreator").classList.contains("hidden")) {
                    const question = document.getElementById("pollQuestion").value.trim();
                    const options = Array.from(document.querySelectorAll('.poll-opt')).map(i => i.value.trim()).filter(Boolean);
                    if(question && options.length >= 2) {
                        pollData = { question, options, votes: {}, votedBy: {} };
                    }
                }
                
                const isFirstPost = (userData?.postCount || 0) === 0;
                
                await runTransaction(db, async (t) => {
                    const userRef = doc(db, "users", currentUser.uid);
                    const boardRef = doc(db, "boards", boardId);
                    
                    // ë¹„ìš© ì°¨ê° & ë³´ìƒ
                    const reward = 100 - writeFee;
                    t.update(userRef, { 
                        coin: increment(reward), 
                        totalEarned: increment(100),
                        totalSpent: increment(writeFee),
                        postCount: increment(1),
                        exp: increment(10)
                    });
                    
                    // ê²Œì‹œíŒ ì—…ë°ì´íŠ¸
                    t.update(boardRef, { postCount: increment(1) });
                    
                    // ê²Œì‹œê¸€ ìƒì„±
                    const postRef = doc(collection(db, "posts"));
                    t.set(postRef, {
                        boardId,
                        authorUid: currentUser.uid,
                        authorName: currentUser.displayName,
                        authorCountry: userData?.country || '',
                        title,
                        content,
                        hashtags,
                        images: imageUrls,
                        poll: pollData,
                        likeCount: 0,
                        likedBy: [],
                        bookmarkedBy: [],
                        commentCount: 0,
                        viewCount: 0,
                        createdAt: new Date().toISOString()
                    });
                });
                
                // ë¯¸ì…˜
                updateMission('posts');
                
                // ì²« ê¸€ ì‘ì„± ì‹œ ì´ˆëŒ€ 2ë‹¨ê³„ ë³´ìƒ
                if(isFirstPost && userData?.invitedBy) {
                    try {
                        await updateDoc(doc(db, "users", userData.invitedBy), { 
                            coin: increment(300), totalEarned: increment(300), inviteRewards: increment(300)
                        });
                        const inviteQuery = query(collection(db, "invites"), where("inviteeUid", "==", currentUser.uid));
                        const inviteSnap = await getDocs(inviteQuery);
                        if(!inviteSnap.empty) {
                            await updateDoc(inviteSnap.docs[0].ref, { stage2: true, stage2At: new Date().toISOString() });
                        }
                        await addDoc(collection(db, "notifications"), {
                            userId: userData.invitedBy,
                            type: 'invite',
                            title: 'ì´ˆëŒ€ ë³´ìƒ',
                            message: `${currentUser.displayName}ë‹˜ì´ ì²« ê¸€ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤! +300 BOK`,
                            read: false,
                            createdAt: new Date().toISOString()
                        });
                    } catch(e) { console.log("ì´ˆëŒ€ ë³´ìƒ ì˜¤ë¥˜:", e); }
                }
                
                // ì´ˆê¸°í™”
                document.getElementById("postTitle").value = "";
                document.getElementById("postContent").value = "";
                hashtags = [];
                uploadedImages = [];
                document.getElementById("hashtagContainer").innerHTML = "";
                document.getElementById("imagePreview").innerHTML = "";
                document.getElementById("pollCreator").classList.add("hidden");
                
                alert("ğŸ‰ ê¸€ ì‘ì„± ì™„ë£Œ! +100 BOK");
            } catch(e) { alert("ì˜¤ë¥˜: " + e); }
            finally { btn.disabled = false; btn.textContent = "ê¸€ ì‘ì„±í•˜ê¸° (+100 BOK)"; }
        };

        // êµ¬ë…
        window.toggleSubscribe = async function() {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            // êµ¬ë… ë¡œì§ (ê°„ë‹¨íˆ êµ¬í˜„)
            const btn = document.getElementById("subscribeBtn");
            btn.classList.toggle("subscribed");
            if(btn.classList.contains("subscribed")) {
                btn.innerHTML = "<span>â­</span> êµ¬ë…ì¤‘";
                await updateDoc(doc(db, "boards", boardId), { memberCount: increment(1) });
            } else {
                btn.innerHTML = "<span>â­</span> êµ¬ë…";
                await updateDoc(doc(db, "boards", boardId), { memberCount: increment(-1) });
            }
        };

        // ì‹ ê³ 
        window.openReportModal = function() {
            selectedReportReason = null;
            document.querySelectorAll('.report-option').forEach(el => el.classList.remove('selected'));
            document.getElementById("reportDetail").value = "";
            openModal('reportModal');
        };

        window.selectReportReason = function(el, reason) {
            document.querySelectorAll('.report-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            selectedReportReason = reason;
        };

        window.submitReport = async function() {
            if(!selectedReportReason) return alert("ì‹ ê³  ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
            
            await addDoc(collection(db, "reports"), {
                type: 'post',
                targetId: currentPostId,
                reason: selectedReportReason,
                detail: document.getElementById("reportDetail").value.trim(),
                reporterUid: currentUser?.uid,
                reporterName: currentUser?.displayName,
                createdAt: new Date().toISOString()
            });
            
            alert("ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeModal('reportModal');
        };

        window.reportComment = async function(commentId) {
            if(!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if(!confirm("ì´ ëŒ“ê¸€ì„ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            
            await addDoc(collection(db, "reports"), {
                type: 'comment',
                targetId: commentId,
                reason: 'report',
                reporterUid: currentUser.uid,
                reporterName: currentUser.displayName,
                createdAt: new Date().toISOString()
            });
            
            alert("ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
        };

        // ê³µìœ 
        window.sharePost = function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url);
            alert("ğŸ”— ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
        };

        // íƒ­ í•„í„°
        window.filterPosts = function(type) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            // ì‹¤ì œ í•„í„° êµ¬í˜„ì€ query ë³€ê²½ìœ¼ë¡œ
        };

        // ë¯¸ì…˜ ì—…ë°ì´íŠ¸
        async function updateMission(type) {
            if(!currentUser) return;
            const today = new Date().toDateString();
            const userRef = doc(db, "users", currentUser.uid);
            const userSnap = await getDoc(userRef);
            const missions = userSnap.data().missions || {};
            const todayMissions = missions[today] || { posts: 0, comments: 0, likes: 0, visits: 0 };
            
            todayMissions[type] = (todayMissions[type] || 0) + 1;
            missions[today] = todayMissions;
            
            await updateDoc(userRef, { missions });
        }

        function timeAgo(dateStr) {
            const diff = Date.now() - new Date(dateStr).getTime();
            const mins = Math.floor(diff / 60000);
            if(mins < 1) return 'ë°©ê¸ˆ ì „';
            if(mins < 60) return `${mins}ë¶„ ì „`;
            const hours = Math.floor(mins / 60);
            if(hours < 24) return `${hours}ì‹œê°„ ì „`;
            return `${Math.floor(hours / 24)}ì¼ ì „`;
        }

        // ì¸ì¦ ìƒíƒœ
        onAuthStateChanged(auth, (user) => {
            if(user) {
                currentUser = user;
                onSnapshot(doc(db, "users", user.uid), (d) => {
                    if(d.exists()) {
                        userData = d.data();
                        document.getElementById("walletBadge").innerText = `ğŸ’° ${(userData.coin||0).toLocaleString()} BOK`;
                    }
                });
            } else {
                document.getElementById("walletBadge").innerText = "ğŸ’° ë¡œê·¸ì¸ í•„ìš”";
            }
        });

        window.openModal = (id) => document.getElementById(id).style.display = "flex";
        window.closeModal = (id) => document.getElementById(id).style.display = "none";

        loadBoard();
    </script>
</body>
</html>
