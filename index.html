<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOKLUCK - ê¸€ ì“°ê³  ë•… ì‚¬ëŠ” Web3 ì»¤ë®¤ë‹ˆí‹°</title>
    <meta name="description" content="BOKLUCKì—ì„œ ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  BOK í† í°ì„ ë°›ìœ¼ì„¸ìš”.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary: #6366f1; --primary-light: #818cf8; --secondary: #06b6d4;
            --accent: #f59e0b; --success: #10b981; --danger: #ef4444; --pink: #ec4899;
            --bg-dark: #0a0a0f; --bg-card: #12121a; --bg-card-hover: #1a1a25;
            --border: #2a2a3a; --text: #f0f0f5; --text-muted: #8888a0;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            --gradient-pink: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        }
        body { background-color: var(--bg-dark); background-image: radial-gradient(ellipse at top, rgba(99,102,241,0.1) 0%, transparent 50%); color: var(--text); font-family: 'Noto Sans KR', sans-serif; min-height: 100vh; }
        .navbar { background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 12px 20px; position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 900; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
        .nav-links { display: flex; gap: 8px; }
        .nav-link { padding: 8px 16px; border-radius: 8px; color: var(--text-muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .nav-link:hover, .nav-link.active { background: var(--bg-card-hover); color: var(--text); }
        .wallet-badge { background: var(--bg-dark); padding: 8px 16px; border-radius: 50px; border: 1px solid var(--border); color: var(--secondary); font-weight: 700; font-size: 14px; }
        .level-badge { background: var(--gradient-gold); color: #1a1a2e; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .container { max-width: 1200px; margin: 0 auto; padding: 24px 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s; }
        .card:hover { border-color: rgba(99,102,241,0.3); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        button { cursor: pointer; border: none; border-radius: 10px; font-weight: 600; padding: 12px 20px; transition: all 0.3s; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 15px rgba(99,102,241,0.3); }
        .btn-gold { background: var(--gradient-gold); color: #1a1a2e; }
        .btn-pink { background: var(--gradient-pink); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-sm { padding: 8px 14px; font-size: 13px; }
        .btn-block { width: 100%; }
        .hero { text-align: center; padding: 60px 20px; background: var(--bg-card); border-radius: 24px; margin-bottom: 24px; border: 1px solid var(--border); position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--gradient-primary); }
        .hero-badge { display: inline-block; background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.3); color: var(--primary-light); padding: 6px 16px; border-radius: 50px; font-size: 13px; font-weight: 600; margin-bottom: 20px; }
        .hero-title { font-size: 36px; font-weight: 900; margin-bottom: 16px; line-height: 1.3; }
        .hero-title .highlight { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-subtitle { font-size: 16px; color: var(--text-muted); margin-bottom: 32px; }
        .stats-bar { display: flex; justify-content: center; gap: 40px; margin-bottom: 32px; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 28px; font-weight: 900; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-label { font-size: 13px; color: var(--text-muted); }
        .feature-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer; }
        .feature-card:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(99,102,241,0.15); }
        .feature-icon { font-size: 40px; margin-bottom: 16px; }
        .feature-title { font-weight: 700; margin-bottom: 8px; }
        .feature-desc { font-size: 13px; color: var(--text-muted); }
        .mission-item { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-dark); border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); }
        .mission-info { display: flex; align-items: center; gap: 12px; }
        .mission-icon { width: 40px; height: 40px; background: var(--bg-card-hover); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .mission-title { font-weight: 600; font-size: 14px; }
        .mission-progress { font-size: 12px; color: var(--text-muted); }
        .mission-reward { background: rgba(16,185,129,0.1); color: var(--success); padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .progress-bar { height: 8px; background: var(--bg-dark); border-radius: 4px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: var(--gradient-primary); border-radius: 4px; transition: width 0.5s ease; }
        .ranking-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-dark); border-radius: 10px; margin-bottom: 8px; }
        .ranking-position { width: 28px; height: 28px; background: var(--bg-card-hover); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; }
        .ranking-position.gold { background: var(--gradient-gold); color: #1a1a2e; }
        .ranking-position.silver { background: linear-gradient(135deg, #94a3b8, #cbd5e1); color: #1a1a2e; }
        .ranking-position.bronze { background: linear-gradient(135deg, #b45309, #d97706); color: white; }
        .ranking-name { flex: 1; font-weight: 500; }
        .ranking-score { color: var(--secondary); font-weight: 700; }
        .roulette-container { text-align: center; padding: 20px; }
        .roulette-wheel { width: 200px; height: 200px; border-radius: 50%; background: conic-gradient(var(--primary) 0deg 45deg, var(--secondary) 45deg 90deg, var(--accent) 90deg 135deg, var(--success) 135deg 180deg, var(--pink) 180deg 225deg, var(--danger) 225deg 270deg, var(--primary-light) 270deg 315deg, #fbbf24 315deg 360deg); margin: 0 auto 20px; position: relative; transition: transform 3s cubic-bezier(0.17,0.67,0.12,0.99); box-shadow: 0 0 30px rgba(99,102,241,0.3); }
        .roulette-wheel::before { content: 'ğŸ¯'; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 40px; background: var(--bg-dark); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .roulette-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 24px; }
        .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .profile-info h2 { font-size: 24px; margin-bottom: 4px; }
        .profile-stats { display: flex; gap: 20px; color: var(--text-muted); font-size: 14px; }
        .achievement-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--bg-dark); border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); }
        .achievement-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .achievement-locked { background: var(--bg-card-hover); opacity: 0.5; }
        .achievement-unlocked { background: var(--gradient-gold); }
        .achievement-info { flex: 1; }
        .achievement-title { font-weight: 600; font-size: 14px; }
        .achievement-desc { font-size: 12px; color: var(--text-muted); }
        .board-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-dark); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; border: 1px solid var(--border); }
        .board-item:hover { background: var(--bg-card-hover); border-color: var(--primary); }
        .board-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .board-info { flex: 1; }
        .board-name { font-weight: 700; margin-bottom: 4px; }
        .board-meta { font-size: 12px; color: var(--text-muted); }
        .board-stats { display: flex; gap: 16px; font-size: 12px; color: var(--text-muted); }
        .board-fee { background: rgba(245,158,11,0.1); color: var(--accent); padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .tabs { display: flex; gap: 4px; background: var(--bg-dark); padding: 4px; border-radius: 12px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; text-align: center; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s; color: var(--text-muted); }
        .tab.active { background: var(--bg-card); color: var(--text); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(8px); }
        .modal-content { background: var(--bg-card); padding: 32px; border-radius: 20px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; border: 1px solid var(--border); position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: var(--bg-dark); border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 18px; color: var(--text-muted); }
        .modal-title { font-size: 22px; font-weight: 900; margin-bottom: 20px; text-align: center; }
        input, textarea, select { width: 100%; background: var(--bg-dark); border: 1px solid var(--border); color: var(--text); padding: 14px 16px; border-radius: 10px; font-size: 15px; font-family: 'Noto Sans KR', sans-serif; margin-bottom: 12px; transition: all 0.2s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--primary); }
        label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 6px; font-weight: 500; }
        .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .toggle-switch { width: 48px; height: 26px; background: var(--bg-dark); border-radius: 13px; position: relative; cursor: pointer; transition: all 0.3s; }
        .toggle-switch.active { background: var(--success); }
        .toggle-switch::before { content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: all 0.3s; }
        .toggle-switch.active::before { left: 25px; }
        .invite-box { background: var(--bg-dark); border: 2px dashed var(--border); border-radius: 12px; padding: 20px; text-align: center; }
        .invite-code { font-size: 24px; font-weight: 900; letter-spacing: 4px; color: var(--secondary); margin: 12px 0; }
        .hidden { display: none !important; }
        .title-badge { background: var(--gradient-gold); color: #1a1a2e; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; white-space: nowrap; }
        .country-flag { font-size: 18px; }
        .title-option { background: var(--bg-dark); border: 1px solid var(--border); padding: 8px 14px; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .title-option:hover { border-color: var(--primary); }
        .title-option.active { background: var(--gradient-gold); color: #1a1a2e; border-color: transparent; }
        .title-option.locked { opacity: 0.4; cursor: not-allowed; }
        
        /* ì´ˆëŒ€ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
        .invite-code { font-size: 28px; font-weight: 900; letter-spacing: 4px; color: var(--primary-light); background: var(--bg-dark); padding: 12px 24px; border-radius: 12px; font-family: monospace; }
        .reward-steps { display: flex; flex-direction: column; gap: 12px; }
        .reward-step { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 10px; }
        .step-icon { font-size: 20px; }
        .step-info { flex: 1; }
        .step-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
        .step-rewards { display: flex; gap: 8px; }
        .reward-tag { font-size: 11px; padding: 3px 8px; border-radius: 10px; font-weight: 600; }
        .reward-tag.inviter { background: rgba(16,185,129,0.15); color: var(--success); }
        .reward-tag.invitee { background: rgba(99,102,241,0.15); color: var(--primary-light); }
        .milestone-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .milestone-item { display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); padding: 8px 12px; border-radius: 8px; flex: 1; min-width: 120px; font-size: 13px; }
        .milestone-item.achieved { background: var(--gradient-gold); color: #1a1a2e; }
        .milestone-reward { font-weight: 700; color: var(--accent); }
        .milestone-item.achieved .milestone-reward { color: #1a1a2e; }
        .invited-friend { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--bg-dark); border-radius: 8px; margin-bottom: 6px; font-size: 13px; }
        .friend-status { display: flex; gap: 4px; }
        .status-badge { width: 8px; height: 8px; border-radius: 50%; }
        .status-badge.done { background: var(--success); }
        .status-badge.pending { background: var(--border); }
        
        /* ê°€ì… í›„ ì´ˆëŒ€ì½”ë“œ ì…ë ¥ ë°°ë„ˆ */
        .invite-banner { background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(236,72,153,0.1)); border: 1px solid rgba(99,102,241,0.3); border-radius: 12px; padding: 16px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
        .invite-banner-text { font-size: 14px; }
        .invite-banner-text strong { color: var(--primary-light); }
        
        @media (max-width: 768px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } .nav-links { display: none; } .hero-title { font-size: 26px; } .stats-bar { gap: 20px; } .stat-number { font-size: 22px; } .milestone-item { min-width: 100%; } }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo" onclick="showSection('home')">BOKLUCK</div>
            <div class="nav-links" id="navLinks">
                <a href="#" class="nav-link active" onclick="showSection('home')">ğŸ  í™ˆ</a>
                <a href="#" class="nav-link" onclick="showSection('boards')">ğŸ“‚ ê²Œì‹œíŒ</a>
                <a href="market.html" class="nav-link">ğŸ—ºï¸ ë¶€ë™ì‚°</a>
                <a href="board-market.html" class="nav-link">ğŸª ë§ˆì¼“</a>
                <a href="#" class="nav-link" onclick="showSection('profile')">ğŸ‘¤ í”„ë¡œí•„</a>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="level-badge" id="levelBadge">Lv.1</span>
                <div class="wallet-badge" id="walletBadge">ğŸ’° ì—°ê²° í•„ìš”</div>
                <button class="btn-sm btn-outline hidden" id="logoutBtn" onclick="logout()" style="padding: 8px 12px;">ğŸšª</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="authSection">
            <div class="hero">
                <span class="hero-badge">ğŸš€ Web3 ì»¤ë®¤ë‹ˆí‹°</span>
                <h1 class="hero-title">ê¸€ ì“°ê³ , ë•… ì‚¬ê³ ,<br><span class="highlight">ë¶€ì ë˜ì!</span></h1>
                <p class="hero-subtitle">ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ë©´ BOK í† í°ì„ ë°›ê³ ,<br>ê°€ìƒ ë¶€ë™ì‚°ì— íˆ¬ìí•´ì„œ ì˜í† ë¥¼ í™•ì¥í•˜ì„¸ìš”!</p>
                <div class="stats-bar">
                    <div class="stat-item"><div class="stat-number" id="statUsers">0</div><div class="stat-label">í™œì„± ìœ ì €</div></div>
                    <div class="stat-item"><div class="stat-number" id="statPosts">0</div><div class="stat-label">ì‘ì„±ëœ ê¸€</div></div>
                    <div class="stat-item"><div class="stat-number" id="statLands">0</div><div class="stat-label">ê±°ë˜ëœ ë•…</div></div>
                </div>
                <button class="btn-primary" id="loginBtn" style="max-width: 320px;">Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°</button>
                <div style="margin-top: 20px;"><input type="text" id="inviteCodeInput" placeholder="ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ (ì„ íƒ)" style="max-width: 200px; text-align: center;"></div>
            </div>
            <div class="grid-3">
                <div class="feature-card"><div class="feature-icon">âœï¸</div><div class="feature-title">ê¸€ì“°ê¸° ë³´ìƒ</div><div class="feature-desc">ê¸€ í•˜ë‚˜ë‹¹ 100 BOK!<br>ëŒ“ê¸€, ì¢‹ì•„ìš”ë¡œ ì¶”ê°€ ìˆ˜ìµ</div></div>
                <div class="feature-card"><div class="feature-icon">ğŸ—ï¸</div><div class="feature-title">ê²Œì‹œíŒ ì†Œìœ </div><div class="feature-desc">ë‚˜ë§Œì˜ ê²Œì‹œíŒ ìš´ì˜<br>ì…ì¥ë£Œ, ìˆ˜ìˆ˜ë£Œ ìˆ˜ìµ</div></div>
                <div class="feature-card"><div class="feature-icon">ğŸ—ºï¸</div><div class="feature-title">ë¶€ë™ì‚° íˆ¬ì</div><div class="feature-desc">ê°€ìƒ ë•… êµ¬ë§¤<br>ëœë¤ ê°€ì¹˜ë¡œ ëŒ€ë°• ì°¬ìŠ¤</div></div>
            </div>
        </div>

        <div id="homeSection" class="hidden">
            <!-- ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ ë°°ë„ˆ (ê°€ì… 7ì¼ ë‚´, ë¯¸ì…ë ¥ ì‹œ) -->
            <div class="invite-banner hidden" id="inviteCodeBanner">
                <div class="invite-banner-text">
                    ğŸ <strong>ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ</strong>ê°€ ìˆë‚˜ìš”? ì§€ê¸ˆ ì…ë ¥í•˜ë©´ <strong>+500 BOK</strong>!
                </div>
                <button class="btn-sm btn-gold" onclick="openModal('profileSettingsModal')">ì…ë ¥í•˜ê¸°</button>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ğŸ“‹ ì¼ì¼ ë¯¸ì…˜</h3><span style="color: var(--text-muted); font-size: 13px;">ë§¤ì¼ ë¦¬ì…‹</span></div>
                    <div id="missionList">
                        <div class="mission-item"><div class="mission-info"><div class="mission-icon">âœï¸</div><div><div class="mission-title">ê¸€ì“°ê¸° 1íšŒ</div><div class="mission-progress">0/1</div></div></div><span class="mission-reward">+100 BOK</span></div>
                        <div class="mission-item"><div class="mission-info"><div class="mission-icon">ğŸ’¬</div><div><div class="mission-title">ëŒ“ê¸€ 3ê°œ</div><div class="mission-progress">0/3</div></div></div><span class="mission-reward">+30 BOK</span></div>
                        <div class="mission-item"><div class="mission-info"><div class="mission-icon">â¤ï¸</div><div><div class="mission-title">ì¢‹ì•„ìš” 5ê°œ</div><div class="mission-progress">0/5</div></div></div><span class="mission-reward">+10 BOK</span></div>
                        <div class="mission-item"><div class="mission-info"><div class="mission-icon">ğŸ </div><div><div class="mission-title">ê²Œì‹œíŒ 3ê³³ ë°©ë¬¸</div><div class="mission-progress">0/3</div></div></div><span class="mission-reward">+20 BOK</span></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ğŸ° ì¶œì„ ë£°ë ›</h3></div>
                    <div class="roulette-container">
                        <div style="position: relative; display: inline-block;"><div class="roulette-pointer">â–¼</div><div class="roulette-wheel" id="rouletteWheel"></div></div>
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 16px;">ë§¤ì¼ 1íšŒ 1~500 BOK!</p>
                        <button class="btn-gold btn-block" id="spinBtn" onclick="spinRoulette()">ğŸ² ëŒë¦¬ê¸°</button>
                    </div>
                </div>
            </div>
            <div class="grid-2" style="margin-top: 20px;">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ğŸ† ì£¼ê°„ ë­í‚¹</h3><span style="color: var(--accent); font-size: 13px;">TOP 10 ë³´ìƒ!</span></div>
                    <div id="rankingList"><div class="ranking-item"><div class="ranking-position gold">1</div><div class="ranking-name">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div><div class="ranking-score">-</div></div></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">âš¡ ë¹ ë¥¸ ì•¡ì…˜</h3></div>
                    <button class="btn-primary btn-block" style="margin-bottom: 12px;" onclick="showSection('boards')">ğŸ“ ê¸€ì“°ê¸° (+100 BOK)</button>
                    <button class="btn-pink btn-block" style="margin-bottom: 12px;" onclick="location.href='market.html'">ğŸ—ºï¸ ë¶€ë™ì‚° ë§ˆì¼“</button>
                    <button class="btn-gold btn-block" style="margin-bottom: 12px;" onclick="openModal('createBoardModal')">ğŸ—ï¸ ê²Œì‹œíŒ ë§Œë“¤ê¸°</button>
                    <button class="btn-outline btn-block" onclick="openModal('inviteModal')">ğŸ‘¥ ì¹œêµ¬ ì´ˆëŒ€ (+300 BOK)</button>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <div class="card-header"><h3 class="card-title">ğŸ”¥ ì¸ê¸° ê²Œì‹œíŒ</h3><button class="btn-sm btn-outline" onclick="showSection('boards')">ì „ì²´ë³´ê¸°</button></div>
                <div id="popularBoards"></div>
            </div>
        </div>

        <div id="boardsSection" class="hidden">
            <div class="card-header" style="margin-bottom: 20px;"><h2 style="font-size: 24px;">ğŸ“‚ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</h2><button class="btn-gold" onclick="openModal('createBoardModal')">+ ê²Œì‹œíŒ ë§Œë“¤ê¸°</button></div>
            <div class="tabs"><div class="tab active" onclick="filterBoards('all')">ì „ì²´</div><div class="tab" onclick="filterBoards('my')">ë‚´ ê²Œì‹œíŒ</div><div class="tab" onclick="filterBoards('free')">ë¬´ë£Œ</div><div class="tab" onclick="filterBoards('premium')">í”„ë¦¬ë¯¸ì—„</div></div>
            <div id="boardsList"></div>
        </div>

        <div id="profileSection" class="hidden">
            <div class="card">
                <div class="profile-header">
                    <div class="profile-avatar">ğŸ‘¤</div>
                    <div class="profile-info">
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                            <span class="title-badge" id="profileBadge">ğŸŒ± ìƒˆì‹¹</span>
                            <span class="country-flag" id="profileFlag">ğŸŒ</span>
                            <h2 id="profileName" style="margin: 0;">ì‚¬ìš©ì</h2>
                        </div>
                        <div class="profile-stats" style="margin-top: 8px;">
                            <span>ğŸ“ ê¸€ <strong id="profilePosts">0</strong></span>
                            <span>ğŸ’¬ ëŒ“ê¸€ <strong id="profileComments">0</strong></span>
                            <span>ğŸ  ê²Œì‹œíŒ <strong id="profileBoards">0</strong></span>
                        </div>
                    </div>
                    <button class="btn-sm btn-outline" onclick="openModal('profileSettingsModal')">âš™ï¸</button>
                </div>
                <div style="background: var(--bg-dark); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span style="font-weight: 700;">ë ˆë²¨ <span id="currentLevel">1</span></span><span style="color: var(--text-muted); font-size: 14px;"><span id="currentExp">0</span> / <span id="nextLevelExp">100</span> EXP</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="expProgress" style="width: 0%;"></div></div>
                </div>
                <div class="grid-3">
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;"><div style="font-size: 24px; font-weight: 900; color: var(--secondary);" id="totalBok">0</div><div style="font-size: 12px; color: var(--text-muted);">ë³´ìœ  BOK</div></div>
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;"><div style="font-size: 24px; font-weight: 900; color: var(--accent);" id="totalEarned">0</div><div style="font-size: 12px; color: var(--text-muted);">ëˆ„ì  ìˆ˜ìµ</div></div>
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;"><div style="font-size: 24px; font-weight: 900; color: var(--pink);" id="totalSpent">0</div><div style="font-size: 12px; color: var(--text-muted);">ëˆ„ì  ì†Œë¹„</div></div>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <div class="card-header"><h3 class="card-title">ğŸ… ì—…ì </h3><span style="color: var(--text-muted); font-size: 13px;">0/6 ë‹¬ì„±</span></div>
                <div id="achievementList">
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">âœï¸</div><div class="achievement-info"><div class="achievement-title">ì²« ê¸€ ì‘ì„±</div><div class="achievement-desc">ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”</div></div><span class="mission-reward">+50 BOK</span></div>
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">ğŸ—ï¸</div><div class="achievement-info"><div class="achievement-title">ê²Œì‹œíŒ ì‚¬ì¥ë‹˜</div><div class="achievement-desc">ê²Œì‹œíŒ ì²« ê°œì„¤</div></div><span class="mission-reward">+200 BOK</span></div>
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">ğŸ—ºï¸</div><div class="achievement-info"><div class="achievement-title">ë¶€ë™ì‚° ì¬ë²Œ</div><div class="achievement-desc">ë•… 10ê°œ ì†Œìœ </div></div><span class="mission-reward">+500 BOK</span></div>
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">ğŸ‘‘</div><div class="achievement-info"><div class="achievement-title">ì§€ì—­ ì •ë³µì</div><div class="achievement-desc">í•œ ì§€ì—­ ìµœëŒ€ ì†Œìœ ì</div></div><span class="mission-reward">+1,000 BOK</span></div>
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">ğŸ‘¥</div><div class="achievement-info"><div class="achievement-title">ì¸í”Œë£¨ì–¸ì„œ</div><div class="achievement-desc">ì¹œêµ¬ 10ëª… ì´ˆëŒ€</div></div><span class="mission-reward">+500 BOK</span></div>
                    <div class="achievement-item"><div class="achievement-icon achievement-locked">ğŸ“</div><div class="achievement-info"><div class="achievement-title">ê¸€ì“°ê¸° ë§ˆìŠ¤í„°</div><div class="achievement-desc">ê¸€ 100ê°œ ì‘ì„±</div></div><span class="mission-reward">+1,000 BOK</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="createBoardModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('createBoardModal')">âœ•</button>
            <h2 class="modal-title">ğŸ—ï¸ ê²Œì‹œíŒ ë§Œë“¤ê¸°</h2>
            <div style="background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 10px; padding: 14px; margin-bottom: 20px; text-align: center;"><span style="color: var(--accent); font-weight: 700; font-size: 18px;">ìƒì„± ë¹„ìš©: 1,000 BOK</span></div>
            <label>ê²Œì‹œíŒ ì´ë¦„</label><input type="text" id="boardName" placeholder="ì˜ˆ: ë¹„íŠ¸ì½”ì¸ íˆ¬ìì ëª¨ì„" maxlength="20">
            <label>ì„¤ëª…</label><textarea id="boardDesc" rows="3" placeholder="ê²Œì‹œíŒì„ ì†Œê°œí•´ì£¼ì„¸ìš”"></textarea>
            <label>ì¹´í…Œê³ ë¦¬</label><select id="boardCategory"><option value="general">ğŸ’¬ ììœ </option><option value="investment">ğŸ’° íˆ¬ì</option><option value="game">ğŸ® ê²Œì„</option><option value="tech">ğŸ’» ê¸°ìˆ </option><option value="life">ğŸŒ± ì¼ìƒ</option></select>
            <label>í…Œë§ˆ ìƒ‰ìƒ</label><input type="color" id="boardColor" value="#6366f1" style="height: 50px; padding: 5px;">
            <label>ì•„ì´ì½˜ (ì´ëª¨ì§€)</label><input type="text" id="boardIcon" placeholder="ğŸ“" maxlength="2" style="font-size: 24px; text-align: center;">
            <div style="border-top: 1px solid var(--border); margin: 20px 0; padding-top: 20px;"><h4 style="margin-bottom: 12px;">ğŸ’° ìˆ˜ìµí™” ì„¤ì •</h4>
                <label>ì…ì¥ë£Œ (0 = ë¬´ë£Œ)</label><input type="number" id="boardEntryFee" value="0" min="0" max="100">
                <label>ê¸€ì“°ê¸° ìˆ˜ìˆ˜ë£Œ</label><input type="number" id="boardWriteFee" value="0" min="0" max="50">
            </div>
            <div style="border-top: 1px solid var(--border); margin: 20px 0; padding-top: 20px;"><h4 style="margin-bottom: 12px;">âš™ï¸ ìš´ì˜ ì„¤ì •</h4>
                <div class="toggle-row"><span>ìŠ¹ì¸ì œ ê²Œì‹œíŒ</span><div class="toggle-switch" id="toggleApproval" onclick="this.classList.toggle('active')"></div></div>
                <div class="toggle-row"><span>ëŒ“ê¸€ í—ˆìš©</span><div class="toggle-switch active" id="toggleComments" onclick="this.classList.toggle('active')"></div></div>
            </div>
            <button class="btn-gold btn-block" onclick="createBoard()">ê²Œì‹œíŒ ìƒì„±í•˜ê¸°</button>
        </div>
    </div>

    <div class="modal-overlay" id="inviteModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('inviteModal')">âœ•</button>
            <h2 class="modal-title">ğŸ‘¥ ì¹œêµ¬ ì´ˆëŒ€</h2>
            
            <!-- ì´ˆëŒ€ ë§í¬/ì½”ë“œ -->
            <div class="invite-box">
                <p style="color: var(--text-muted); margin-bottom: 8px;">ğŸ“ ì´ˆëŒ€ ë§í¬</p>
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                    <input type="text" id="inviteLinkInput" readonly style="flex: 1; margin: 0; font-size: 13px; padding: 10px;">
                    <button class="btn-primary btn-sm" onclick="copyInviteLink()">ë³µì‚¬</button>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 8px;">ğŸ”‘ ì´ˆëŒ€ ì½”ë“œ</p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                    <div class="invite-code" id="myInviteCode">------</div>
                    <button class="btn-outline btn-sm" onclick="copyInviteCode()">ğŸ“‹</button>
                </div>
            </div>
            
            <!-- ë¦¬ì›Œë“œ ì•ˆë‚´ -->
            <div style="margin-top: 20px; padding: 20px; background: var(--bg-dark); border-radius: 12px;">
                <h4 style="margin-bottom: 16px; text-align: center;">ğŸ ë‹¨ê³„ë³„ ë¦¬ì›Œë“œ <span style="color: var(--accent);">(ìµœëŒ€ 1,000 BOK)</span></h4>
                <div class="reward-steps">
                    <div class="reward-step">
                        <div class="step-icon">1ï¸âƒ£</div>
                        <div class="step-info">
                            <div class="step-title">ì¹œêµ¬ê°€ ê°€ì…</div>
                            <div class="step-rewards">
                                <span class="reward-tag inviter">ë‚˜ +300</span>
                                <span class="reward-tag invitee">ì¹œêµ¬ +500</span>
                            </div>
                        </div>
                    </div>
                    <div class="reward-step">
                        <div class="step-icon">2ï¸âƒ£</div>
                        <div class="step-info">
                            <div class="step-title">ì¹œêµ¬ê°€ ì²« ê¸€ ì‘ì„±</div>
                            <div class="step-rewards">
                                <span class="reward-tag inviter">ë‚˜ +300</span>
                                <span class="reward-tag invitee">ì¹œêµ¬ +100</span>
                            </div>
                        </div>
                    </div>
                    <div class="reward-step">
                        <div class="step-icon">3ï¸âƒ£</div>
                        <div class="step-info">
                            <div class="step-title">ì¹œêµ¬ê°€ ì²« ë•… êµ¬ë§¤</div>
                            <div class="step-rewards">
                                <span class="reward-tag inviter">ë‚˜ +400</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì´ˆëŒ€ í˜„í™© -->
            <div style="margin-top: 20px;">
                <h4 style="margin-bottom: 12px;">ğŸ“Š ì´ˆëŒ€ í˜„í™©</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 900; color: var(--secondary);" id="inviteCount">0</div>
                        <div style="font-size: 11px; color: var(--text-muted);">ì´ˆëŒ€í•œ ì¹œêµ¬</div>
                    </div>
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 900; color: var(--success);" id="inviteActive">0</div>
                        <div style="font-size: 11px; color: var(--text-muted);">í™œë™ ì¤‘</div>
                    </div>
                    <div style="background: var(--bg-dark); padding: 16px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: 900; color: var(--accent);" id="inviteEarned">0</div>
                        <div style="font-size: 11px; color: var(--text-muted);">íšë“ BOK</div>
                    </div>
                </div>
                
                <!-- ì´ˆëŒ€í•œ ì¹œêµ¬ ëª©ë¡ -->
                <div id="invitedFriendsList" style="max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <!-- ë§ˆì¼ìŠ¤í†¤ -->
            <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(236,72,153,0.1)); border-radius: 12px; border: 1px solid rgba(245,158,11,0.2);">
                <h4 style="margin-bottom: 12px;">ğŸ† ì´ˆëŒ€ ë§ˆì¼ìŠ¤í†¤</h4>
                <div class="milestone-list">
                    <div class="milestone-item" id="milestone5"><span>ğŸ‘¥ 5ëª…</span><span class="milestone-reward">+500 BOK</span></div>
                    <div class="milestone-item" id="milestone10"><span>ğŸŒŸ 10ëª…</span><span class="milestone-reward">+1,000 BOK</span></div>
                    <div class="milestone-item" id="milestone25"><span>ğŸ’ 25ëª…</span><span class="milestone-reward">+3,000 BOK</span></div>
                    <div class="milestone-item" id="milestone50"><span>ğŸ‘‘ 50ëª…</span><span class="milestone-reward">+10,000 BOK</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="rouletteResultModal">
        <div class="modal-content" style="text-align: center;">
            <h2 class="modal-title">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <div style="font-size: 48px; margin: 20px 0;">ğŸ°</div>
            <div style="font-size: 36px; font-weight: 900; color: var(--accent); margin-bottom: 20px;">+<span id="rouletteResult">0</span> BOK</div>
            <button class="btn-primary btn-block" onclick="closeModal('rouletteResultModal')">í™•ì¸</button>
        </div>
    </div>

    <!-- í”„ë¡œí•„ ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="profileSettingsModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('profileSettingsModal')">âœ•</button>
            <h2 class="modal-title">âš™ï¸ í”„ë¡œí•„ ì„¤ì •</h2>
            
            <!-- ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ (ê°€ì… 7ì¼ ë‚´) -->
            <div id="inviteCodeEntrySection" style="display: none; margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(236,72,153,0.1)); border: 1px solid rgba(99,102,241,0.3); border-radius: 12px;">
                <h4 style="margin-bottom: 8px;">ğŸ ì´ˆëŒ€ ì½”ë“œ ì…ë ¥</h4>
                <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">ê°€ì… 7ì¼ ë‚´ ì…ë ¥ ê°€ëŠ¥! ì…ë ¥ ì‹œ <strong style="color: var(--success);">+500 BOK</strong></p>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="enterInviteCode" placeholder="ì´ˆëŒ€ ì½”ë“œ ì…ë ¥" style="flex: 1; margin: 0; text-transform: uppercase;">
                    <button class="btn-gold" onclick="applyInviteCode()">ì ìš©</button>
                </div>
                <p id="inviteCodeDaysLeft" style="font-size: 11px; color: var(--accent); margin-top: 8px; text-align: center;"></p>
            </div>
            
            <label>ğŸŒ êµ­ê°€ ì„ íƒ</label>
            <select id="countrySelect" onchange="updateCountry()">
                <option value="ğŸŒ">ğŸŒ ë¯¸ì„¤ì •</option>
                <option value="ğŸ‡°ğŸ‡·">ğŸ‡°ğŸ‡· í•œêµ­</option>
                <option value="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</option>
                <option value="ğŸ‡¯ğŸ‡µ">ğŸ‡¯ğŸ‡µ ì¼ë³¸</option>
                <option value="ğŸ‡¨ğŸ‡³">ğŸ‡¨ğŸ‡³ ì¤‘êµ­</option>
                <option value="ğŸ‡¬ğŸ‡§">ğŸ‡¬ğŸ‡§ ì˜êµ­</option>
                <option value="ğŸ‡©ğŸ‡ª">ğŸ‡©ğŸ‡ª ë…ì¼</option>
                <option value="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤</option>
                <option value="ğŸ‡ªğŸ‡¸">ğŸ‡ªğŸ‡¸ ìŠ¤í˜ì¸</option>
                <option value="ğŸ‡®ğŸ‡¹">ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•„</option>
                <option value="ğŸ‡§ğŸ‡·">ğŸ‡§ğŸ‡· ë¸Œë¼ì§ˆ</option>
                <option value="ğŸ‡¨ğŸ‡¦">ğŸ‡¨ğŸ‡¦ ìºë‚˜ë‹¤</option>
                <option value="ğŸ‡¦ğŸ‡º">ğŸ‡¦ğŸ‡º í˜¸ì£¼</option>
                <option value="ğŸ‡®ğŸ‡³">ğŸ‡®ğŸ‡³ ì¸ë„</option>
                <option value="ğŸ‡·ğŸ‡º">ğŸ‡·ğŸ‡º ëŸ¬ì‹œì•„</option>
                <option value="ğŸ‡²ğŸ‡½">ğŸ‡²ğŸ‡½ ë©•ì‹œì½”</option>
                <option value="ğŸ‡¹ğŸ‡­">ğŸ‡¹ğŸ‡­ íƒœêµ­</option>
                <option value="ğŸ‡»ğŸ‡³">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨</option>
                <option value="ğŸ‡µğŸ‡­">ğŸ‡µğŸ‡­ í•„ë¦¬í•€</option>
                <option value="ğŸ‡¸ğŸ‡¬">ğŸ‡¸ğŸ‡¬ ì‹±ê°€í¬ë¥´</option>
            </select>
            
            <label style="margin-top: 16px;">ğŸ… ëŒ€í‘œ ì¹­í˜¸ ì„ íƒ</label>
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">ë‹¬ì„±í•œ ì—…ì ì˜ ì¹­í˜¸ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            <div id="titleSelectList" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">
                <div class="title-option active" data-title="ğŸŒ± ìƒˆì‹¹" onclick="selectTitle(this)">ğŸŒ± ìƒˆì‹¹</div>
            </div>
            
            <button class="btn-primary btn-block" onclick="saveProfileSettings()">ì €ì¥í•˜ê¸°</button>
            
            <div style="border-top: 1px solid var(--border); margin-top: 24px; padding-top: 20px;">
                <button class="btn-outline btn-block" style="color: var(--danger); border-color: var(--danger);" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, query, orderBy, where, increment, runTransaction, limit, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyBwQjuqgWM4YKnqu_gzNbeCg5alrC-jVcQ", authDomain: "myco-737a0.firebaseapp.com", projectId: "myco-737a0", storageBucket: "myco-737a0.firebasestorage.app", messagingSenderId: "942571332540", appId: "1:942571332540:web:be0bb6fbdd32655501c1b9" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let currentUser = null, userData = null;

        async function loadStats() {
            try {
                const [users, posts, lands] = await Promise.all([getDocs(collection(db, "users")), getDocs(collection(db, "posts")), getDocs(collection(db, "lands"))]);
                document.getElementById("statUsers").textContent = users.size;
                document.getElementById("statPosts").textContent = posts.size;
                document.getElementById("statLands").textContent = lands.size;
            } catch(e) {}
        }
        loadStats();

        document.getElementById("loginBtn").addEventListener("click", async () => {
            try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch(e) {}
        });

        // URLì—ì„œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        if(refCode) {
            document.getElementById("inviteCodeInput").value = refCode;
        }

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                currentUser = user;
                document.getElementById("authSection").classList.add("hidden");
                document.getElementById("homeSection").classList.remove("hidden");
                const userRef = doc(db, "users", user.uid);
                onSnapshot(userRef, async (docSnap) => {
                    if(!docSnap.exists()) {
                        // ìƒˆ ì‚¬ìš©ì ìƒì„±
                        const inviteCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                        const inputCode = document.getElementById("inviteCodeInput").value.trim().toUpperCase() || refCode?.toUpperCase();
                        
                        let inviterUid = null;
                        let inviterBonus = 0;
                        
                        // ì´ˆëŒ€ ì½”ë“œ ê²€ì¦
                        if(inputCode) {
                            const inviterQuery = query(collection(db, "users"), where("inviteCode", "==", inputCode));
                            const inviterSnap = await getDocs(inviterQuery);
                            if(!inviterSnap.empty) {
                                const inviterDoc = inviterSnap.docs[0];
                                inviterUid = inviterDoc.id;
                                // ì´ˆëŒ€ìì—ê²Œ 1ë‹¨ê³„ ë³´ìƒ (300 BOK)
                                await updateDoc(doc(db, "users", inviterUid), { 
                                    coin: increment(300), 
                                    totalEarned: increment(300),
                                    inviteCount: increment(1),
                                    inviteRewards: increment(300)
                                });
                                // ì´ˆëŒ€ ê¸°ë¡ ì €ì¥
                                await addDoc(collection(db, "invites"), {
                                    inviterUid: inviterUid,
                                    inviteeUid: user.uid,
                                    inviteeName: user.displayName,
                                    stage1: true,  // ê°€ì… ì™„ë£Œ
                                    stage2: false, // ì²« ê¸€ ì‘ì„±
                                    stage3: false, // ì²« ë•… êµ¬ë§¤
                                    stage1At: new Date().toISOString(),
                                    createdAt: new Date().toISOString()
                                });
                                inviterBonus = 500; // ê°€ì…ìì—ê²Œ ì¶”ê°€ ë³´ë„ˆìŠ¤ (ê¸°ë³¸ 500 + 0)
                            }
                        }
                        
                        await setDoc(userRef, { 
                            name: user.displayName, 
                            email: user.email, 
                            coin: 500 + (inviterUid ? 500 : 0), // ê¸°ë³¸ 500 + ì´ˆëŒ€ë°›ì€ ë³´ë„ˆìŠ¤ 500
                            exp: 0, 
                            level: 1, 
                            totalEarned: 500 + (inviterUid ? 500 : 0), 
                            totalSpent: 0, 
                            postCount: 0, 
                            commentCount: 0,
                            landCount: 0,
                            boardCount: 0,
                            inviteCode: inviteCode, 
                            inviteCount: 0,
                            inviteRewards: 0,
                            invitedBy: inviterUid || null,
                            inviteCodeUsed: !!inviterUid,
                            lastRoulette: null, 
                            createdAt: new Date().toISOString()
                        });
                        
                        if(inviterUid) {
                            alert("ğŸ‰ ì´ˆëŒ€ ì½”ë“œ ì ìš©! +500 BOK ë³´ë„ˆìŠ¤ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!");
                        }
                    }
                    userData = docSnap.data();
                    updateUI();
                    checkInviteCodeBanner();
                    loadInvitedFriends();
                });
                loadBoards();
                loadRanking();
            } else {
                document.getElementById("authSection").classList.remove("hidden");
                document.getElementById("homeSection").classList.add("hidden");
                document.getElementById("boardsSection").classList.add("hidden");
                document.getElementById("profileSection").classList.add("hidden");
            }
        });

        function updateUI() {
            if(!userData) return;
            document.getElementById("walletBadge").innerHTML = `ğŸ’° ${(userData.coin||0).toLocaleString()} BOK`;
            document.getElementById("levelBadge").textContent = `Lv.${userData.level||1}`;
            document.getElementById("currentLevel").textContent = userData.level||1;
            const exp = userData.exp||0, nextExp = (userData.level||1)*100;
            document.getElementById("currentExp").textContent = exp;
            document.getElementById("nextLevelExp").textContent = nextExp;
            document.getElementById("expProgress").style.width = `${(exp/nextExp)*100}%`;
            document.getElementById("profileName").textContent = userData.name||"ì‚¬ìš©ì";
            document.getElementById("profilePosts").textContent = userData.postCount||0;
            document.getElementById("profileComments").textContent = userData.commentCount||0;
            document.getElementById("totalBok").textContent = (userData.coin||0).toLocaleString();
            document.getElementById("totalEarned").textContent = (userData.totalEarned||0).toLocaleString();
            document.getElementById("totalSpent").textContent = (userData.totalSpent||0).toLocaleString();
            document.getElementById("myInviteCode").textContent = userData.inviteCode||"------";
            document.getElementById("inviteCount").textContent = userData.inviteCount||0;
            document.getElementById("inviteEarned").textContent = (userData.inviteRewards||0).toLocaleString();
            
            // ì´ˆëŒ€ ë§í¬ ì„¤ì •
            const baseUrl = window.location.origin + window.location.pathname;
            document.getElementById("inviteLinkInput").value = `${baseUrl}?ref=${userData.inviteCode||''}`;
            
            // ë§ˆì¼ìŠ¤í†¤ ì²´í¬
            const count = userData.inviteCount || 0;
            if(count >= 5) document.getElementById("milestone5").classList.add("achieved");
            if(count >= 10) document.getElementById("milestone10").classList.add("achieved");
            if(count >= 25) document.getElementById("milestone25").classList.add("achieved");
            if(count >= 50) document.getElementById("milestone50").classList.add("achieved");
            
            // êµ­ê°€ & ì¹­í˜¸
            document.getElementById("profileFlag").textContent = userData.country || "ğŸŒ";
            document.getElementById("profileBadge").textContent = userData.title || "ğŸŒ± ìƒˆì‹¹";
            document.getElementById("countrySelect").value = userData.country || "ğŸŒ";
            
            // ì¹­í˜¸ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateTitleOptions();
            
            // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í‘œì‹œ
            document.getElementById("logoutBtn").classList.remove("hidden");
            
            const lastRoulette = userData.lastRoulette;
            if(lastRoulette && new Date(lastRoulette).toDateString() === new Date().toDateString()) {
                document.getElementById("spinBtn").disabled = true;
                document.getElementById("spinBtn").textContent = "âœ… ì™„ë£Œ";
            }
        }

        // ì¹­í˜¸ ì˜µì…˜ ëª©ë¡
        const allTitles = [
            { id: "newbie", title: "ğŸŒ± ìƒˆì‹¹", condition: "ê¸°ë³¸", unlocked: true },
            { id: "writer", title: "âœï¸ ì‘ê°€", condition: "ê¸€ 10ê°œ ì‘ì„±", check: (u) => (u.postCount||0) >= 10 },
            { id: "master", title: "ğŸ“š ë¬¸í•„ê°€", condition: "ê¸€ 100ê°œ ì‘ì„±", check: (u) => (u.postCount||0) >= 100 },
            { id: "social", title: "ğŸ’¬ ìˆ˜ë‹¤ìŸì´", condition: "ëŒ“ê¸€ 50ê°œ ì‘ì„±", check: (u) => (u.commentCount||0) >= 50 },
            { id: "landlord", title: "ğŸ  ì§€ì£¼", condition: "ë•… 5ê°œ ì†Œìœ ", check: (u) => (u.landCount||0) >= 5 },
            { id: "tycoon", title: "ğŸ° ëŒ€ì§€ì£¼", condition: "ë•… 20ê°œ ì†Œìœ ", check: (u) => (u.landCount||0) >= 20 },
            { id: "ceo", title: "ğŸ—ï¸ ì‚¬ì¥ë‹˜", condition: "ê²Œì‹œíŒ 1ê°œ ì†Œìœ ", check: (u) => (u.boardCount||0) >= 1 },
            { id: "influencer", title: "ğŸ‘¥ ì¸í”Œë£¨ì–¸ì„œ", condition: "ì¹œêµ¬ 10ëª… ì´ˆëŒ€", check: (u) => (u.inviteCount||0) >= 10 },
            { id: "whale", title: "ğŸ‹ ê³ ë˜", condition: "ëˆ„ì  ìˆ˜ìµ 10,000 BOK", check: (u) => (u.totalEarned||0) >= 10000 },
            { id: "legend", title: "ğŸ‘‘ ë ˆì „ë“œ", condition: "ë ˆë²¨ 50 ë‹¬ì„±", check: (u) => (u.level||1) >= 50 },
        ];

        function updateTitleOptions() {
            const container = document.getElementById("titleSelectList");
            container.innerHTML = "";
            allTitles.forEach(t => {
                const unlocked = t.unlocked || (t.check && t.check(userData));
                const isActive = (userData.title || "ğŸŒ± ìƒˆì‹¹") === t.title;
                container.innerHTML += `
                    <div class="title-option ${isActive ? 'active' : ''} ${!unlocked ? 'locked' : ''}" 
                         data-title="${t.title}" 
                         title="${t.condition}"
                         onclick="${unlocked ? 'selectTitle(this)' : 'alert(\'ì¡°ê±´: ' + t.condition + '\')'}">
                        ${t.title} ${!unlocked ? 'ğŸ”’' : ''}
                    </div>
                `;
            });
        }

        window.selectTitle = function(el) {
            if(el.classList.contains('locked')) return;
            document.querySelectorAll('.title-option').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        };

        window.updateCountry = function() {
            // ì„ íƒë§Œ í•˜ê³  ì €ì¥ì€ saveProfileSettingsì—ì„œ
        };

        window.saveProfileSettings = async function() {
            const country = document.getElementById("countrySelect").value;
            const activeTitle = document.querySelector('.title-option.active');
            const title = activeTitle ? activeTitle.dataset.title : "ğŸŒ± ìƒˆì‹¹";
            
            await updateDoc(doc(db, "users", currentUser.uid), { country, title });
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            closeModal('profileSettingsModal');
        };

        window.logout = async function() {
            if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            await signOut(auth);
            location.reload();
        };

        // ì´ˆëŒ€ ì½”ë“œ ë°°ë„ˆ ì²´í¬ (ê°€ì… 7ì¼ ë‚´, ë¯¸ì‚¬ìš©)
        function checkInviteCodeBanner() {
            if(!userData) return;
            if(userData.inviteCodeUsed) {
                document.getElementById("inviteCodeBanner").classList.add("hidden");
                document.getElementById("inviteCodeEntrySection").style.display = "none";
                return;
            }
            
            const createdAt = new Date(userData.createdAt);
            const now = new Date();
            const daysDiff = Math.floor((now - createdAt) / (1000 * 60 * 60 * 24));
            const daysLeft = 7 - daysDiff;
            
            if(daysLeft > 0) {
                document.getElementById("inviteCodeBanner").classList.remove("hidden");
                document.getElementById("inviteCodeEntrySection").style.display = "block";
                document.getElementById("inviteCodeDaysLeft").textContent = `â° ${daysLeft}ì¼ ë‚¨ìŒ`;
            } else {
                document.getElementById("inviteCodeBanner").classList.add("hidden");
                document.getElementById("inviteCodeEntrySection").style.display = "none";
            }
        }

        // ê°€ì… í›„ ì´ˆëŒ€ ì½”ë“œ ì ìš©
        window.applyInviteCode = async function() {
            const code = document.getElementById("enterInviteCode").value.trim().toUpperCase();
            if(!code) return alert("ì´ˆëŒ€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if(code === userData.inviteCode) return alert("ìì‹ ì˜ ì½”ë“œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            if(userData.inviteCodeUsed) return alert("ì´ë¯¸ ì´ˆëŒ€ ì½”ë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.");
            
            // 7ì¼ ì²´í¬
            const createdAt = new Date(userData.createdAt);
            const now = new Date();
            const daysDiff = Math.floor((now - createdAt) / (1000 * 60 * 60 * 24));
            if(daysDiff >= 7) return alert("ì´ˆëŒ€ ì½”ë“œëŠ” ê°€ì… 7ì¼ ë‚´ì—ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            
            // ì´ˆëŒ€ ì½”ë“œ ê²€ì¦
            const inviterQuery = query(collection(db, "users"), where("inviteCode", "==", code));
            const inviterSnap = await getDocs(inviterQuery);
            if(inviterSnap.empty) return alert("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ˆëŒ€ ì½”ë“œì…ë‹ˆë‹¤.");
            
            const inviterDoc = inviterSnap.docs[0];
            const inviterUid = inviterDoc.id;
            
            try {
                // ì´ˆëŒ€ìì—ê²Œ 1ë‹¨ê³„ ë³´ìƒ
                await updateDoc(doc(db, "users", inviterUid), { 
                    coin: increment(300), 
                    totalEarned: increment(300),
                    inviteCount: increment(1),
                    inviteRewards: increment(300)
                });
                
                // ê°€ì…ìì—ê²Œ ë³´ìƒ
                await updateDoc(doc(db, "users", currentUser.uid), { 
                    coin: increment(500), 
                    totalEarned: increment(500),
                    invitedBy: inviterUid,
                    inviteCodeUsed: true
                });
                
                // ì´ˆëŒ€ ê¸°ë¡ ì €ì¥
                await addDoc(collection(db, "invites"), {
                    inviterUid: inviterUid,
                    inviteeUid: currentUser.uid,
                    inviteeName: currentUser.displayName,
                    stage1: true,
                    stage2: false,
                    stage3: false,
                    stage1At: new Date().toISOString(),
                    createdAt: new Date().toISOString()
                });
                
                alert("ğŸ‰ ì´ˆëŒ€ ì½”ë“œ ì ìš© ì™„ë£Œ! +500 BOK!");
                closeModal('profileSettingsModal');
                document.getElementById("inviteCodeBanner").classList.add("hidden");
            } catch(e) {
                alert("ì˜¤ë¥˜: " + e);
            }
        };

        // ì´ˆëŒ€í•œ ì¹œêµ¬ ëª©ë¡ ë¡œë“œ
        async function loadInvitedFriends() {
            if(!currentUser) return;
            // ì¸ë±ìŠ¤ ì—†ì´ ì‘ë™í•˜ë„ë¡ whereë§Œ ì‚¬ìš©
            const q = query(collection(db, "invites"), where("inviterUid", "==", currentUser.uid));
            const snapshot = await getDocs(q);
            
            const list = document.getElementById("invitedFriendsList");
            let activeCount = 0;
            
            if(snapshot.empty) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 16px;">ì•„ì§ ì´ˆëŒ€í•œ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì •ë ¬ (ìµœì‹ ìˆœ)
            let invites = [];
            snapshot.forEach(docSnap => invites.push({ id: docSnap.id, ...docSnap.data() }));
            invites.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            list.innerHTML = "";
            invites.forEach(inv => {
                if(inv.stage2 || inv.stage3) activeCount++;
                list.innerHTML += `
                    <div class="invited-friend">
                        <span>${inv.inviteeName || 'ì¹œêµ¬'}</span>
                        <div class="friend-status">
                            <div class="status-badge ${inv.stage1 ? 'done' : 'pending'}" title="ê°€ì…"></div>
                            <div class="status-badge ${inv.stage2 ? 'done' : 'pending'}" title="ì²« ê¸€"></div>
                            <div class="status-badge ${inv.stage3 ? 'done' : 'pending'}" title="ì²« ë•…"></div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById("inviteActive").textContent = activeCount;
        }

        // ì´ˆëŒ€ ë§í¬ ë³µì‚¬
        window.copyInviteLink = function() {
            const link = document.getElementById("inviteLinkInput").value;
            navigator.clipboard.writeText(link).then(() => {
                alert("ğŸ“ ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            });
        };

        // ì´ˆëŒ€ ì½”ë“œ ë³µì‚¬
        window.copyInviteCode = function() {
            const code = userData?.inviteCode || '';
            navigator.clipboard.writeText(code).then(() => {
                alert("ğŸ“‹ ì´ˆëŒ€ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            });
        };

        async function loadBoards() {
            const q = query(collection(db, "boards"), orderBy("createdAt", "desc"));
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById("boardsList");
                const popular = document.getElementById("popularBoards");
                list.innerHTML = ""; popular.innerHTML = "";
                if(snapshot.empty) { list.innerHTML = '<p style="text-align:center; color: var(--text-muted); padding: 40px;">ì•„ì§ ê²Œì‹œíŒì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
                let count = 0;
                snapshot.forEach(docSnap => {
                    const b = docSnap.data();
                    const feeText = (b.entryFee > 0) ? `<span class="board-fee">${b.entryFee} BOK</span>` : '<span style="color: var(--success); font-size: 12px;">ë¬´ë£Œ</span>';
                    const html = `<div class="board-item" onclick="location.href='board.html?id=${docSnap.id}'"><div class="board-icon" style="background: ${b.color||'#6366f1'};">${b.icon||'ğŸ“'}</div><div class="board-info"><div class="board-name">${b.name}</div><div class="board-meta">${b.description||''}</div></div><div style="text-align: right;">${feeText}<div class="board-stats" style="margin-top: 4px;"><span>ğŸ‘¤ ${b.memberCount||0}</span><span>ğŸ“ ${b.postCount||0}</span></div></div></div>`;
                    list.innerHTML += html;
                    if(count < 3) popular.innerHTML += html;
                    count++;
                });
            });
        }

        async function loadRanking() {
            const q = query(collection(db, "users"), orderBy("totalEarned", "desc"), limit(10));
            const snapshot = await getDocs(q);
            const list = document.getElementById("rankingList");
            list.innerHTML = "";
            let rank = 1;
            snapshot.forEach(docSnap => {
                const u = docSnap.data();
                const posClass = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
                const flag = u.country || '';
                const title = u.title ? `<span style="font-size: 11px; background: rgba(245,158,11,0.2); color: var(--accent); padding: 2px 6px; border-radius: 10px; margin-right: 4px;">${u.title}</span>` : '';
                list.innerHTML += `<div class="ranking-item"><div class="ranking-position ${posClass}">${rank}</div><div class="ranking-name">${flag} ${title}${u.name||'ìµëª…'}</div><div class="ranking-score">${(u.totalEarned||0).toLocaleString()}</div></div>`;
                rank++;
            });
        }

        window.createBoard = async function() {
            if(!currentUser || !userData) return alert("ë¡œê·¸ì¸ í•„ìš”");
            if(userData.coin < 1000) return alert("BOK ë¶€ì¡± (í•„ìš”: 1,000)");
            const name = document.getElementById("boardName").value.trim();
            if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
            const desc = document.getElementById("boardDesc").value.trim();
            const category = document.getElementById("boardCategory").value;
            const color = document.getElementById("boardColor").value;
            const icon = document.getElementById("boardIcon").value || "ğŸ“";
            const entryFee = parseInt(document.getElementById("boardEntryFee").value) || 0;
            const writeFee = parseInt(document.getElementById("boardWriteFee").value) || 0;
            const approval = document.getElementById("toggleApproval").classList.contains("active");
            const comments = document.getElementById("toggleComments").classList.contains("active");
            try {
                await runTransaction(db, async (t) => {
                    t.update(doc(db, "users", currentUser.uid), { coin: increment(-1000), totalSpent: increment(1000) });
                    t.set(doc(collection(db, "boards")), { name, description: desc, category, color, icon, entryFee, writeFee, requireApproval: approval, allowComments: comments, ownerUid: currentUser.uid, ownerName: currentUser.displayName, memberCount: 1, postCount: 0, createdAt: new Date().toISOString() });
                });
                alert("ğŸ‰ ê²Œì‹œíŒ ìƒì„± ì™„ë£Œ!");
                closeModal('createBoardModal');
            } catch(e) { alert("ì˜¤ë¥˜: " + e); }
        };

        window.spinRoulette = async function() {
            if(!currentUser || !userData) return;
            const lastRoulette = userData.lastRoulette;
            if(lastRoulette && new Date(lastRoulette).toDateString() === new Date().toDateString()) return alert("ì˜¤ëŠ˜ ì´ë¯¸ ì™„ë£Œ!");
            const btn = document.getElementById("spinBtn");
            btn.disabled = true;
            const wheel = document.getElementById("rouletteWheel");
            wheel.style.transform = `rotate(${1800 + Math.random() * 360}deg)`;
            const rand = Math.random();
            let reward;
            if(rand < 0.5) reward = Math.floor(Math.random() * 50) + 1;
            else if(rand < 0.8) reward = Math.floor(Math.random() * 100) + 50;
            else if(rand < 0.95) reward = Math.floor(Math.random() * 150) + 150;
            else reward = Math.floor(Math.random() * 200) + 300;
            setTimeout(async () => {
                await updateDoc(doc(db, "users", currentUser.uid), { coin: increment(reward), totalEarned: increment(reward), lastRoulette: new Date().toISOString() });
                document.getElementById("rouletteResult").textContent = reward;
                openModal('rouletteResultModal');
                btn.textContent = "âœ… ì™„ë£Œ";
            }, 3000);
        };

        window.showSection = function(section) {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById("homeSection").classList.add("hidden");
            document.getElementById("boardsSection").classList.add("hidden");
            document.getElementById("profileSection").classList.add("hidden");
            if(section === 'home') document.getElementById("homeSection").classList.remove("hidden");
            else if(section === 'boards') document.getElementById("boardsSection").classList.remove("hidden");
            else if(section === 'profile') document.getElementById("profileSection").classList.remove("hidden");
        };

        window.openModal = (id) => document.getElementById(id).style.display = "flex";
        window.closeModal = (id) => document.getElementById(id).style.display = "none";
        window.copyInviteCode = () => { navigator.clipboard.writeText(document.getElementById("myInviteCode").textContent); alert("ë³µì‚¬ë¨!"); };
        window.filterBoards = (type) => { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); event.target.classList.add('active'); };
    </script>
</body>
</html>
