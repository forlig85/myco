<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO ê°œì„  -->
    <title>BOKLUCK - ê¸€ ì“°ê³  ë•… ì‚¬ëŠ” Web3 ì»¤ë®¤ë‹ˆí‹°</title>
    <meta name="description" content="BOKLUCKì—ì„œ ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  BOK í† í°ì„ ë°›ìœ¼ì„¸ìš”. ê°€ìƒ ë¶€ë™ì‚°ì„ êµ¬ë§¤í•˜ê³  ì˜í† ë¥¼ í™•ì¥í•˜ëŠ” ìƒˆë¡œìš´ ê²½í—˜!">
    <meta name="keywords" content="BOKLUCK, BOK, ì»¤ë®¤ë‹ˆí‹°, ë¶€ë™ì‚°, í† í°, Web3">
    <meta property="og:title" content="BOKLUCK - ê¸€ ì“°ê³  ë•… ì‚¬ëŠ” Web3 ì»¤ë®¤ë‹ˆí‹°">
    <meta property="og:description" content="ì½˜í…ì¸  ì‘ì„±ìœ¼ë¡œ BOK í† í°ì„ íšë“í•˜ê³ , ê°€ìƒ ë¶€ë™ì‚°ì— íˆ¬ìí•˜ì„¸ìš”!">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ </text></svg>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        * { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #06b6d4;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --border: #2a2a3a;
            --text: #f0f0f5;
            --text-muted: #8888a0;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        }
        
        body { 
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(ellipse at top, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(6, 182, 212, 0.05) 0%, transparent 50%);
            color: var(--text); 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }
        
        main { flex: 1; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { 
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px; 
            padding: 24px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.1);
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { 
            cursor: pointer; 
            border: none; 
            border-radius: 12px; 
            font-weight: 600; 
            padding: 14px 24px; 
            transition: all 0.3s ease; 
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 15px;
        }
        button:hover { transform: translateY(-2px); }
        button:active { transform: translateY(0); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-primary { 
            background: var(--gradient-primary);
            color: white; 
            width: 100%; 
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        .btn-primary:hover { 
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
        }
        
        .btn-market { 
            background: var(--gradient-gold);
            color: #1a1a2e; 
            width: 100%; 
            font-size: 18px; 
            font-weight: 700;
            margin-bottom: 24px; 
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
            padding: 18px 24px;
        }
        .btn-market:hover { 
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.5);
        }
        
        .btn-small { 
            padding: 8px 16px; 
            font-size: 13px; 
            border-radius: 8px;
            font-weight: 600;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        /* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ */
        .btn-cheat { 
            background: transparent;
            border: 1px dashed var(--danger);
            color: var(--danger); 
            width: 100%; 
            margin-bottom: 16px;
            font-size: 13px;
            opacity: 0.6;
            padding: 10px;
        }
        .btn-cheat:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        
        /* í—¤ë” */
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            padding: 20px 0;
        }
        
        .logo { 
            font-size: 28px; 
            font-weight: 900; 
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }
        
        .wallet { 
            background: var(--bg-card);
            padding: 10px 20px; 
            border-radius: 50px; 
            border: 1px solid var(--border);
            color: var(--secondary);
            font-weight: 700; 
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .wallet::before {
            content: 'ğŸ’°';
        }
        
        /* ë³´ë“œ/í¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .board-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 18px; 
            border-bottom: 1px solid var(--border);
            cursor: pointer; 
            transition: all 0.2s ease;
            border-radius: 8px;
            margin: 4px 0;
        }
        .board-item:hover { 
            background: var(--bg-card-hover);
            border-color: transparent;
        }
        .board-item:last-child { border-bottom: none; }
        
        .board-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .post-item { 
            padding: 18px; 
            border-bottom: 1px solid var(--border);
            cursor: pointer; 
            transition: all 0.2s ease;
            border-radius: 8px;
            margin: 4px 0;
        }
        .post-item:hover { 
            background: var(--bg-card-hover);
        }
        .post-item:last-child { border-bottom: none; }
        
        .post-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 6px;
        }
        
        .post-meta {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* ì…ë ¥ í•„ë“œ */
        input, textarea { 
            width: 100%; 
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text); 
            padding: 16px; 
            border-radius: 12px; 
            font-size: 15px; 
            margin-bottom: 12px; 
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.3s ease;
        }
        input:focus, textarea:focus { 
            outline: none; 
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        input::placeholder, textarea::placeholder {
            color: var(--text-muted);
        }
        
        .hidden { display: none; }
        
        .back-link { 
            color: var(--text-muted); 
            cursor: pointer; 
            font-size: 14px; 
            margin-bottom: 16px; 
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
            font-weight: 500;
        }
        .back-link:hover { color: var(--text); }

        /* ========== íˆì–´ë¡œ ì„¹ì…˜ ========== */
        .hero-section {
            text-align: center;
            padding: 60px 30px;
            background: var(--bg-card);
            border-radius: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }
        
        .hero-badge {
            display: inline-block;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--primary-light);
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .hero-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 16px;
            line-height: 1.3;
            letter-spacing: -1px;
        }
        .hero-title .highlight {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 16px;
            color: var(--text-muted);
            margin-bottom: 40px;
            line-height: 1.7;
        }
        
        /* í†µê³„ */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 32px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ê¸°ëŠ¥ ì¹´ë“œ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.15);
        }
        
        .feature-icon { 
            font-size: 40px; 
            margin-bottom: 16px;
            display: block;
        }
        .feature-title { 
            font-size: 15px; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        .feature-desc { 
            font-size: 13px; 
            color: var(--text-muted); 
            line-height: 1.5; 
        }

        /* BOK í† í° ì •ë³´ */
        .token-info {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .token-info h4 {
            color: var(--secondary);
            margin-bottom: 16px;
            font-size: 16px;
            font-weight: 700;
        }
        
        .token-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .token-item {
            background: rgba(99, 102, 241, 0.15);
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 13px;
            color: var(--primary-light);
            font-weight: 500;
        }

        /* ì˜¨ë³´ë”© íŒ */
        .onboarding-tip {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(251, 191, 36, 0.1) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #fbbf24;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .onboarding-tip .close-tip {
            margin-left: auto;
            cursor: pointer;
            opacity: 0.7;
            font-size: 18px;
        }
        .onboarding-tip .close-tip:hover { opacity: 1; }

        /* ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-card-hover) 25%, var(--border) 50%, var(--bg-card-hover) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 10px;
            height: 70px;
            margin-bottom: 10px;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ì„¹ì…˜ í—¤ë” */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .section-header h3 {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* í‘¸í„° */
        footer {
            margin-top: 60px;
            padding: 30px 0;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 13px;
        }
        
        footer a {
            color: var(--text-muted);
            text-decoration: none;
            margin: 0 12px;
            transition: color 0.2s;
        }
        footer a:hover { color: var(--text); }
        
        .footer-links { margin-bottom: 16px; }
        
        .footer-disclaimer {
            margin-top: 12px;
            font-size: 11px;
            color: #666;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            .hero-title { font-size: 26px; }
            .hero-subtitle { font-size: 14px; }
            .feature-grid { grid-template-columns: 1fr; }
            .stats-bar { gap: 24px; }
            .stat-number { font-size: 26px; }
            header { flex-direction: column; gap: 16px; }
            .wallet { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">BOKLUCK</div>
        <div id="walletBadge" class="wallet">ì—°ê²° ì¤‘...</div>
    </header>

    <main>
        <!-- ë¡œê·¸ì¸ ì „: ëœë”© í˜ì´ì§€ -->
        <div id="authSection">
            <div class="hero-section">
                <span class="hero-badge">ğŸš€ Web3 ì»¤ë®¤ë‹ˆí‹°</span>
                <h1 class="hero-title">
                    ê¸€ ì“°ê³ , ë•… ì‚¬ê³ ,<br><span class="highlight">ë¶€ì ë˜ì!</span>
                </h1>
                <p class="hero-subtitle">
                    ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ë©´ BOK í† í°ì„ ë°›ê³ ,<br>
                    ê°€ìƒ ë¶€ë™ì‚°ì— íˆ¬ìí•´ì„œ ì˜í† ë¥¼ í™•ì¥í•˜ì„¸ìš”!
                </p>
                
                <!-- ì†Œì…œ í”„ë£¨í”„ -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-number" id="statUsers">--</div>
                        <div class="stat-label">í™œì„± ìœ ì €</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statPosts">--</div>
                        <div class="stat-label">ì‘ì„±ëœ ê¸€</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statLands">--</div>
                        <div class="stat-label">ê±°ë˜ëœ ë•…</div>
                    </div>
                </div>
                
                <button id="loginBtn" class="btn-primary" style="max-width: 320px; margin: 0 auto;">
                    Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°
                </button>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-icon">âœï¸</span>
                    <div class="feature-title">ê¸€ì“°ê¸° ë³´ìƒ</div>
                    <div class="feature-desc">ê¸€ í•˜ë‚˜ë‹¹ 100 BOK!<br>ì–‘ì§ˆì˜ ì½˜í…ì¸ ë¡œ ë¶€ìë˜ì„¸ìš”</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ—ï¸</span>
                    <div class="feature-title">ê²Œì‹œíŒ ì†Œìœ </div>
                    <div class="feature-desc">1,000 BOKìœ¼ë¡œ<br>ë‚˜ë§Œì˜ ê²Œì‹œíŒ ìš´ì˜</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ—ºï¸</span>
                    <div class="feature-title">ë¶€ë™ì‚° íˆ¬ì</div>
                    <div class="feature-desc">ì „ ì„¸ê³„ ê°€ìƒ ë•…ì„<br>êµ¬ë§¤í•˜ê³  ì˜í†  í™•ì¥</div>
                </div>
            </div>

            <div class="token-info">
                <h4>ğŸ’° BOK í† í° ê²½ì œ</h4>
                <div class="token-list">
                    <span class="token-item">ğŸ“ ê¸€ì“°ê¸° +100 BOK</span>
                    <span class="token-item">ğŸ  ë•… êµ¬ë§¤ 300 BOK</span>
                    <span class="token-item">ğŸ“‹ ê²Œì‹œíŒ ìƒì„± 1,000 BOK</span>
                    <span class="token-item">ğŸ ê°€ì… ë³´ë„ˆìŠ¤ 500 BOK</span>
                </div>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸ í›„: ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
        <div id="mainDashboard" class="hidden">
            <!-- ì˜¨ë³´ë”© íŒ -->
            <div id="onboardingTip" class="onboarding-tip hidden">
                <span>ğŸ’¡</span>
                <span><strong>ì²˜ìŒì´ì‹ ê°€ìš”?</strong> ê²Œì‹œíŒì— ê¸€ì„ ì“°ë©´ 100 BOKì„ ë°›ì•„ìš”!</span>
                <span class="close-tip" onclick="dismissTip()">âœ•</span>
            </div>

            <button class="btn-cheat" onclick="getRich()">ğŸ› ï¸ [í…ŒìŠ¤íŠ¸ìš©] 100,000 BOK ì¶©ì „</button>
            <button class="btn-market" onclick="location.href='market.html'">ğŸ—ºï¸ ë¶€ë™ì‚° ë§ˆì¼“ ì…ì¥</button>

            <div id="boardListSection">
                <div class="section-header">
                    <h3>ğŸ“‚ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</h3>
                    <button class="btn-small btn-success" onclick="createBoard()">+ ê²Œì‹œíŒ êµ¬ë§¤</button>
                </div>
                <div class="card" id="boardList">
                    <div class="skeleton"></div>
                    <div class="skeleton"></div>
                </div>
            </div>

            <div id="postListSection" class="hidden">
                <span class="back-link" onclick="showBoardList()">â† ê²Œì‹œíŒ ëª©ë¡</span>
                <div class="section-header">
                    <h3 id="currentBoardName">ê²Œì‹œíŒ</h3>
                    <button class="btn-small btn-primary" onclick="showWriteForm()">ğŸ–Šï¸ ê¸€ì“°ê¸°</button>
                </div>
                <div class="card" id="postList"></div>
            </div>

            <div id="writeSection" class="hidden">
                <span class="back-link" onclick="backToPostList()">â† ì·¨ì†Œ</span>
                <div class="card">
                    <h3 style="margin-bottom: 20px;">ğŸ“ ì½˜í…ì¸  ìƒì‚°</h3>
                    <input type="text" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="100">
                    <textarea id="content" rows="8" placeholder="ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš” (ìµœì†Œ 10ì)"></textarea>
                    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">ğŸ’¡ ë“±ë¡ ì™„ë£Œ ì‹œ 100 BOKì´ ì§€ê¸‰ë©ë‹ˆë‹¤!</p>
                    <button id="saveBtn" class="btn-primary">ë“±ë¡ ì™„ë£Œ (+100 BOK)</button>
                </div>
            </div>

            <div id="viewSection" class="hidden">
                <span class="back-link" onclick="backToPostList()">â† ëª©ë¡ìœ¼ë¡œ</span>
                <div class="card">
                    <h2 id="viewTitle" style="margin-bottom: 12px; font-size: 22px;">ì œëª©</h2>
                    <div style="margin-bottom: 24px; color: var(--text-muted); font-size: 13px; display: flex; justify-content: space-between; align-items: center;">
                        <span id="viewAuthor">ì‘ì„±ì</span>
                        <span id="viewControls"></span>
                    </div>
                    <div id="viewContent" style="white-space: pre-wrap; line-height: 1.8; font-size: 15px;">ë‚´ìš©</div>
                </div>
            </div>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer>
        <div class="footer-links">
            <a href="#">ì´ìš©ì•½ê´€</a>
            <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
            <a href="#">FAQ</a>
            <a href="#">ë¬¸ì˜í•˜ê¸°</a>
        </div>
        <p>Â© 2024 BOKLUCK. All rights reserved.</p>
        <p class="footer-disclaimer">
            BOKì€ BOKLUCK í”Œë«í¼ ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ìƒ í¬ì¸íŠ¸ì´ë©°, ì‹¤ì œ í™”í ê°€ì¹˜ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, setDoc, getDoc, updateDoc, runTransaction, increment, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBwQjuqgWM4YKnqu_gzNbeCg5alrC-jVcQ",
          authDomain: "myco-737a0.firebaseapp.com",
          projectId: "myco-737a0",
          storageBucket: "myco-737a0.firebasestorage.app",
          messagingSenderId: "942571332540",
          appId: "1:942571332540:web:be0bb6fbdd32655501c1b9"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let currentBoardId = null;
        let currentPostId = null; 
        let isEditMode = false;

        // í†µê³„ ë¡œë“œ
        async function loadStats() {
            try {
                const usersSnap = await getDocs(collection(db, "users"));
                const postsSnap = await getDocs(collection(db, "posts"));
                const landsSnap = await getDocs(collection(db, "lands"));
                
                document.getElementById("statUsers").textContent = usersSnap.size || "0";
                document.getElementById("statPosts").textContent = postsSnap.size || "0";
                document.getElementById("statLands").textContent = landsSnap.size || "0";
            } catch(e) {
                console.log("Stats load error:", e);
            }
        }
        loadStats();

        // ì˜¨ë³´ë”©
        window.dismissTip = () => {
            document.getElementById("onboardingTip").style.display = "none";
            localStorage.setItem("bokluck_tip_dismissed", "true");
        }

        function showOnboardingIfNeeded() {
            if(!localStorage.getItem("bokluck_tip_dismissed")) {
                document.getElementById("onboardingTip").classList.remove("hidden");
            }
        }

        window.showBoardList = () => { hideAll(); document.getElementById("boardListSection").style.display = "block"; }
        window.showPostList = (boardId, boardName) => {
            currentBoardId = boardId;
            document.getElementById("currentBoardName").innerText = boardName;
            hideAll(); document.getElementById("postListSection").style.display = "block";
            loadPosts(boardId);
        }
        window.showWriteForm = () => {
            isEditMode = false;
            document.getElementById("title").value = "";
            document.getElementById("content").value = "";
            document.getElementById("saveBtn").innerText = "ë“±ë¡ ì™„ë£Œ (+100 BOK)";
            hideAll(); document.getElementById("writeSection").style.display = "block";
        }
        window.backToPostList = () => { hideAll(); document.getElementById("postListSection").style.display = "block"; }
        function hideAll() {
            document.getElementById("boardListSection").style.display = "none";
            document.getElementById("postListSection").style.display = "none";
            document.getElementById("writeSection").style.display = "none";
            document.getElementById("viewSection").style.display = "none";
        }

        window.getRich = async () => {
            if(!currentUser) return;
            if(!confirm("âš ï¸ í…ŒìŠ¤íŠ¸ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.\n100,000 BOKì„ ì¶©ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            await updateDoc(doc(db, "users", currentUser.uid), { coin: increment(100000) });
            alert("ì¶©ì „ ì™„ë£Œ! ğŸ’¸");
        }

        document.getElementById("loginBtn").addEventListener("click", () => {
            signInWithPopup(auth, new GoogleAuthProvider());
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById("authSection").style.display = "none";
                document.getElementById("mainDashboard").classList.remove("hidden");
                document.getElementById("mainDashboard").style.display = "block";
                document.getElementById("walletBadge").style.display = "flex";
                
                showOnboardingIfNeeded();
                
                onSnapshot(doc(db, "users", user.uid), (d) => {
                    const coin = d.exists() ? d.data().coin : 0;
                    document.getElementById("walletBadge").innerText = `${coin.toLocaleString()} BOK`;
                    if(!d.exists()) setDoc(doc.ref, {name: user.displayName, email: user.email, coin: 500, createdAt: new Date().toISOString()});
                });
                createDefaultBoard();
            } else {
                document.getElementById("authSection").style.display = "block";
                document.getElementById("mainDashboard").style.display = "none";
                document.getElementById("walletBadge").innerText = "ë¡œê·¸ì¸ í•„ìš”";
            }
        });

        async function createDefaultBoard() {}
        onSnapshot(query(collection(db, "boards"), orderBy("createdAt", "desc")), (snapshot) => {
            const list = document.getElementById("boardList");
            list.innerHTML = "";
            if(snapshot.empty) setDoc(doc(collection(db, "boards")), { name: "ììœ ê²Œì‹œíŒ", creatorName: "SYSTEM", isDefault: true, createdAt: new Date().toISOString() });
            snapshot.forEach(doc => {
                const b = doc.data();
                const div = document.createElement("div");
                div.className = "board-item";
                div.innerHTML = `<div><div class="board-name">${b.name}</div><div style="font-size: 12px; color: var(--text-muted);">ì†Œìœ ì: ${b.creatorName}</div></div><div style="color: var(--text-muted); font-size: 14px;">ì…ì¥ â†’</div>`;
                div.onclick = () => showPostList(doc.id, b.name);
                list.appendChild(div);
            });
        });

        window.createBoard = async () => {
            const name = prompt("ğŸ“‹ ê²Œì‹œíŒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”\n(ë¹„ìš©: 1,000 BOK)");
            if(!name) return;
            try {
                await runTransaction(db, async (t) => {
                    const userRef = doc(db, "users", currentUser.uid);
                    const userDoc = await t.get(userRef);
                    if(userDoc.data().coin < 1000) throw "âŒ BOKì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: 1,000 BOK)";
                    t.update(userRef, { coin: increment(-1000) });
                    t.set(doc(collection(db, "boards")), { name: name, creatorName: currentUser.displayName, creatorUid: currentUser.uid, createdAt: new Date().toISOString() });
                });
                alert("ğŸ‰ ê²Œì‹œíŒì´ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } catch(e) { alert(e); }
        }

        let unsubscribePosts = null;
        function loadPosts(boardId) {
            const postList = document.getElementById("postList");
            postList.innerHTML = '<div class="skeleton"></div><div class="skeleton"></div>';
            
            if(unsubscribePosts) unsubscribePosts();
            const q = query(collection(db, "posts"), where("boardId", "==", boardId));
            unsubscribePosts = onSnapshot(q, (snapshot) => {
                const list = document.getElementById("postList");
                list.innerHTML = "";
                let posts = [];
                snapshot.forEach(d => posts.push({id: d.id, ...d.data()}));
                
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));

                if(posts.length === 0) {
                    list.innerHTML = "<div style='padding: 40px; text-align: center; color: var(--text-muted);'>ì•„ì§ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br><br>ì²« ê¸€ì„ ì‘ì„±í•˜ê³  <strong style=\"color: var(--secondary);\">100 BOK</strong>ì„ ë°›ì•„ë³´ì„¸ìš”! âœï¸</div>";
                }
                
                posts.forEach(p => {
                    const div = document.createElement("div");
                    div.className = "post-item";
                    div.innerHTML = `<div class="post-title">${p.title}</div><div class="post-meta">${p.author} Â· ${new Date(p.date).toLocaleDateString()}</div>`;
                    div.onclick = () => viewPost(p.id, p);
                    list.appendChild(div);
                });
            });
        }

        function viewPost(postId, postData) {
            currentPostId = postId;
            document.getElementById("viewTitle").innerText = postData.title;
            document.getElementById("viewAuthor").innerText = `${postData.author} Â· ${new Date(postData.date).toLocaleString()}`;
            document.getElementById("viewContent").innerText = postData.content;
            const controls = document.getElementById("viewControls");
            controls.innerHTML = "";
            if(currentUser && postData.uid === currentUser.uid) {
                const editBtn = document.createElement("button");
                editBtn.className = "btn-small";
                editBtn.style.cssText = "background: var(--bg-card-hover); color: var(--text);";
                editBtn.innerText = "ìˆ˜ì •";
                editBtn.onclick = () => openEditForm(postData);
                controls.appendChild(editBtn);
            }
            hideAll(); document.getElementById("viewSection").style.display = "block";
        }

        function openEditForm(postData) {
            isEditMode = true;
            document.getElementById("title").value = postData.title;
            document.getElementById("content").value = postData.content;
            document.getElementById("saveBtn").innerText = "ìˆ˜ì • ì™„ë£Œ";
            hideAll(); document.getElementById("writeSection").style.display = "block";
        }

        document.getElementById("saveBtn").addEventListener("click", async () => {
            const title = document.getElementById("title").value.trim();
            const content = document.getElementById("content").value.trim();
            if(content.length < 10) return alert("ë‚´ìš©ì„ 10ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”.");
            if(!title) return alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const btn = document.getElementById("saveBtn");
            btn.disabled = true;
            btn.innerText = "ì²˜ë¦¬ ì¤‘...";

            try {
                if(isEditMode) {
                    await updateDoc(doc(db, "posts", currentPostId), { title: title, content: content });
                    alert("âœ… ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    backToPostList(); 
                } else {
                    await runTransaction(db, async (t) => {
                        t.set(doc(collection(db, "posts")), { boardId: currentBoardId, title: title, content: content, author: currentUser.displayName, uid: currentUser.uid, reward: 100, date: new Date().toISOString() });
                        t.update(doc(db, "users", currentUser.uid), { coin: increment(100) });
                    });
                    alert("ğŸ‰ ë“±ë¡ ì™„ë£Œ! (+100 BOK)");
                    backToPostList();
                }
            } catch(e) { 
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e); 
            } finally {
                btn.disabled = false;
                btn.innerText = isEditMode ? "ìˆ˜ì • ì™„ë£Œ" : "ë“±ë¡ ì™„ë£Œ (+100 BOK)";
            }
        });
    </script>
</body>
</html>
